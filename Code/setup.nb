(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    201561,       5254]
NotebookOptionsPosition[    187776,       5059]
NotebookOutlinePosition[    188188,       5075]
CellTagsIndexPosition[    188145,       5072]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Color schemes", "Subsubsection",
 CellChangeTimes->{{3.8684766361053257`*^9, 
  3.8684766392345457`*^9}},ExpressionUUID->"2854a677-3287-478d-bfb8-\
1210155908e0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"magentaCyanBlack", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
  RowBox[{"Blend", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Black", ",", 
      RowBox[{"Blend", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"RGBColor", "[", 
           RowBox[{"1", ",", "0", ",", "1"}], "]"}], ",", 
          RowBox[{"RGBColor", "[", 
           RowBox[{"0", ",", "0.8", ",", "1"}], "]"}]}], "}"}], ",", "x"}], 
       "]"}]}], "}"}], ",", "y"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.868129359179221*^9, 3.868129409770487*^9}, {
  3.868129607800803*^9, 3.868129608536077*^9}, {3.868130310121752*^9, 
  3.868130317206929*^9}, {3.86813239626893*^9, 3.8681323982754374`*^9}, {
  3.8681324369643593`*^9, 3.868132492337694*^9}, {3.8681326087825947`*^9, 
  3.868132609921699*^9}, {3.868147086730522*^9, 3.86814721439505*^9}, {
  3.8682980155726748`*^9, 3.8682980164883413`*^9}, {3.8682999392669086`*^9, 
  3.868299950738077*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"22330982-232e-4dd3-9168-c7712757c539"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Data loading", "Subsubsection",
 CellChangeTimes->{{3.858183682417988*^9, 
  3.858183683761498*^9}},ExpressionUUID->"ecdba1eb-3309-4e82-b2c7-\
88ffe0c4d305"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pythonVersion", "[", 
   RowBox[{"path_", ":", "\"\</opt/miniconda3/bin/python3\>\""}], "]"}], ":=", 
  RowBox[{"RunProcess", "[", 
   RowBox[{"$SystemShell", ",", "All", ",", 
    RowBox[{"path", "<>", "\"\< --version\>\""}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.855814229111245*^9, 3.855814243807905*^9}, {
  3.855814274642467*^9, 3.8558142755876713`*^9}, {3.8581050204237423`*^9, 
  3.858105042857687*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"d8b8f33f-8fa5-47c0-bfbf-f188df775b74"],

Cell[BoxData[
 RowBox[{
  RowBox[{"extractHDF5fromMatFile", "[", "fileName_", "]"}], ":=", 
  RowBox[{"RunProcess", "[", 
   RowBox[{"$SystemShell", ",", "All", ",", 
    RowBox[{
    "\"\</opt/miniconda3/bin/python3 mat_to_h5.py '\>\"", "<>", "fileName", 
     "<>", "\"\<'\>\""}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.857328659964971*^9, 3.857328674234561*^9}, {
  3.857328742354306*^9, 3.8573287703014727`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"aa7597b1-a995-4df1-80cb-dd1ffbcfb60e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"loadVertexCoords", "[", "fileName_", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dataRaw", "=", "\[IndentingNewLine]", 
      RowBox[{"Import", "[", 
       RowBox[{"fileName", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<RawData\>\"", ",", 
          RowBox[{"First", "@", 
           RowBox[{"Import", "[", 
            RowBox[{"fileName", ",", "\"\<Datasets\>\""}], "]"}]}]}], "}"}]}],
        "]"}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"3", ";;", 
            RowBox[{"-", "1"}]}], "]"}], "]"}], "&"}], "/@", "#"}], "&"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"Values", "@", 
       RowBox[{"GroupBy", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"Normal", "[", "dataRaw", "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"First", "[", 
           RowBox[{"Round", "[", "#", "]"}], "]"}], "&"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.857940579546741*^9, 3.8579405940541887`*^9}, {
  3.857940685405951*^9, 3.857940725883444*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"645b3a5a-6091-44fb-9fec-3417be95f059"],

Cell[BoxData[
 RowBox[{
  RowBox[{"loadExpandedData", "[", "fileName_", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"dataRaw", "=", 
      RowBox[{"Import", "[", 
       RowBox[{"fileName", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<RawData\>\"", ",", 
          RowBox[{"First", "@", 
           RowBox[{"Import", "[", 
            RowBox[{"fileName", ",", "\"\<Datasets\>\""}], "]"}]}]}], "}"}]}],
        "]"}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Last", "/@", "#"}], "&"}], "/@", 
        RowBox[{"GroupBy", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], ",", "First"}], 
         "]"}]}], "&"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Values", "@", 
       RowBox[{"GroupBy", "[", 
        RowBox[{
         RowBox[{"Round", "[", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Normal", "[", "dataRaw", "]"}], "]"}], "]"}], ",", 
         "First"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8579407741774607`*^9, 3.8579408109462337`*^9}, {
  3.857940877353115*^9, 3.8579408804627542`*^9}, {3.857940960641341*^9, 
  3.8579409628346167`*^9}, {3.858014709242557*^9, 3.8580147124160767`*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"578da685-c707-4169-bf7f-33ce6d646a03"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mesh pre-processing", "Subsubsection",
 CellChangeTimes->{{3.922048965816456*^9, 
  3.922048969326902*^9}},ExpressionUUID->"c8a15600-5f9d-414e-a3da-\
c7a09089e895"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findCellCentroid", "[", 
   RowBox[{"c_", ",", "t_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vertices", "=", 
       RowBox[{
        RowBox[{"cellVerticesTS", "[", 
         RowBox[{"[", "t", "]"}], "]"}], "[", "c", "]"}]}], ",", 
      "\[IndentingNewLine]", "vi", ",", "\[IndentingNewLine]", "com", ",", 
      "areas", ",", "sum"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MatchQ", "[", 
         RowBox[{"vertices", ",", 
          RowBox[{"{", 
           RowBox[{"_Integer", ".."}], "}"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"vi", "=", 
      RowBox[{"vertexCoordsTS", "[", 
       RowBox[{"[", 
        RowBox[{"t", ",", "vertices"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"com", "=", 
      RowBox[{"Mean", "[", "vi", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vi", "]"}], "<", "4"}], ",", 
       RowBox[{"Return", "[", "com", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sum", ",", 
        RowBox[{"{", "areas", "}"}]}], "}"}], "=", 
      RowBox[{"Reap", "@", 
       RowBox[{"Total", "[", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Sow", "[", 
             RowBox[{"triangleArea", "[", 
              RowBox[{"{", 
               RowBox[{"com", ",", "#1", ",", "#2"}], "}"}], "]"}], "]"}], 
            RowBox[{"Mean", "[", 
             RowBox[{"{", 
              RowBox[{"com", ",", "#1", ",", "#2"}], "}"}], "]"}]}], "&"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"vi", ",", 
            RowBox[{"RotateLeft", "[", "vi", "]"}]}], "}"}]}], "]"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sum", "/", 
      RowBox[{"Total", "[", "areas", "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.9220500540171328`*^9, 3.9220501218099813`*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"17cd2f00-7692-439d-aa28-9b46dbdae290"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Strain fitter", "Subsubsection",
 CellChangeTimes->{{3.86475261014393*^9, 3.8647526154739027`*^9}, {
  3.8647527026869507`*^9, 
  3.864752704780101*^9}},ExpressionUUID->"d913c777-c59e-46b1-a425-\
0e8e52a5b026"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fitDeformationMatrix", "[", 
   RowBox[{"p0_", ",", "p1_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"com0", "=", 
       RowBox[{"Mean", "[", "p0", "]"}]}], ",", 
      RowBox[{"com1", "=", 
       RowBox[{"Mean", "[", "p1", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"q0", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", "com0"}], "&"}], "/@", "p0"}]}], ",", 
        RowBox[{"q1", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", "com1"}], "&"}], "/@", "p1"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
       "com0", ",", "\[IndentingNewLine]", "com1", ",", "\[IndentingNewLine]", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"LeastSquares", "[", 
           RowBox[{
            RowBox[{"SparseArray", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"3", "i"}], "-", "2"}], ",", "j"}], "}"}], "->", 
                   RowBox[{"q0", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"3", "i"}], "-", "1"}], ",", 
                    RowBox[{"j", "+", "3"}]}], "}"}], "->", 
                   RowBox[{"q0", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"3", "i"}], ",", 
                    RowBox[{"j", "+", "6"}]}], "}"}], "->", 
                   RowBox[{"q0", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"Length", "[", "q0", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "3"}], "}"}]}], "]"}], "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Flatten", "[", "q1", "]"}]}], "\[IndentingNewLine]", 
           "]"}], ",", "3"}], "]"}]}], "\[IndentingNewLine]", "}"}]}], 
     "\[IndentingNewLine]", "]"}]}], "]"}]}]], "Input",
 CellLabel->"In[7]:=",ExpressionUUID->"fad0a8a1-17af-4fe2-9fbb-e7f81f424df4"],

Cell["\<\
Constrain the transformation of a specified vector, e.g. the normal to the \
surface. \
\>", "Text",
 CellChangeTimes->{{3.877633945077704*^9, 
  3.877633998901123*^9}},ExpressionUUID->"98582073-510a-433c-8a7e-\
e1a2308562ae"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fitDeformationMatrix", "[", 
   RowBox[{"p0_", ",", "p1_", ",", "n0_", ",", "n1_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "com0", ",", "com1", ",", "q0", ",", "q1", ",", "\[IndentingNewLine]", 
      "a", ",", "A"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "=", 
      RowBox[{"Array", "[", 
       RowBox[{"a", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "3"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"com0", "=", 
      RowBox[{"Mean", "[", "p0", "]"}]}], ";", 
     RowBox[{"com1", "=", 
      RowBox[{"Mean", "[", "p1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"q0", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "-", "com0"}], "&"}], "/@", "p0"}]}], ";", 
     RowBox[{"q1", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "-", "com1"}], "&"}], "/@", "p1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "com0", ",", "\[IndentingNewLine]", "com1", ",", "\[IndentingNewLine]", 
       
       RowBox[{"A", "/.", 
        RowBox[{"Last", "@", 
         RowBox[{"NMinimize", "[", 
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", ".", "#"}], "&"}], "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"A", ".", 
                   RowBox[{"q0", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "-", 
                  RowBox[{"q1", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "[", "q0", "]"}]}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"A", ".", "n0"}], "==", "n1"}]}], "\[IndentingNewLine]",
             "}"}], ",", 
           RowBox[{"Flatten", "[", "A", "]"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.86883162330411*^9, 3.86883163378622*^9}, {
  3.8688317073170033`*^9, 3.8688317630957737`*^9}, {3.86883190965291*^9, 
  3.868831957034013*^9}, {3.868831997374632*^9, 3.868832074811933*^9}, {
  3.868832124283648*^9, 3.868832161056418*^9}, {3.8688322488093147`*^9, 
  3.8688322968370934`*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"34c39e81-fee8-4af6-ad14-f01256fac6d8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fitDeformationMatrix2D", "[", 
   RowBox[{"p0_", ",", "p1_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "com0", ",", "com1", ",", "q0", ",", "q1", ",", "\[IndentingNewLine]", 
      "a", ",", "A"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "=", 
      RowBox[{"Array", "[", 
       RowBox[{"a", ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"com0", "=", 
      RowBox[{"Mean", "[", "p0", "]"}]}], ";", 
     RowBox[{"com1", "=", 
      RowBox[{"Mean", "[", "p1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"q0", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "-", "com0"}], "&"}], "/@", "p0"}]}], ";", 
     RowBox[{"q1", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "-", "com1"}], "&"}], "/@", "p1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "com0", ",", "\[IndentingNewLine]", "com1", ",", "\[IndentingNewLine]", 
       
       RowBox[{"A", "/.", 
        RowBox[{"Last", "@", 
         RowBox[{"FindMinimum", "[", 
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"#", ".", "#"}], "&"}], "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"A", ".", 
                  RowBox[{"q0", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "-", 
                 RowBox[{"q1", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "q0", "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", "}"}], ",", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Flatten", "[", "A", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}], 
            "]"}]}], "]"}]}]}]}], "\[IndentingNewLine]", "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.871567403698369*^9, 3.8715674143438387`*^9}, {
  3.871567627551898*^9, 3.871567628887684*^9}, {3.871575227647326*^9, 
  3.8715752787243357`*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"2be57e66-0a0a-4b87-80ee-d9b4f9531cdc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fitDeformationMatrix2D", "[", 
   RowBox[{"p0_", ",", "p1_", ",", "\"\<NoCOM\>\""}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "A"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "=", 
      RowBox[{"Array", "[", 
       RowBox[{"a", ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"A", "/.", 
      RowBox[{"Last", "@", 
       RowBox[{"FindMinimum", "[", 
        RowBox[{
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", ".", "#"}], "&"}], "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"A", ".", 
                RowBox[{"p0", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "-", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "p0", "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", "}"}], ",", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Flatten", "[", "A", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}], 
          "]"}]}], "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.871928825883829*^9, 3.871928866749222*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"e81b9df3-9e41-4440-9772-d56fa4ce860f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fitDeformationMatrix2D", "[", 
   RowBox[{"p0_", ",", "p1_", ",", "\"\<Symmetric\>\""}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "com0", ",", "com1", ",", "q0", ",", "q1", ",", "\[IndentingNewLine]", 
      "a"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"A", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"a", "[", "1", "]"}], ",", 
           RowBox[{"a", "[", "2", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"a", "[", "2", "]"}], ",", 
           RowBox[{"a", "[", "3", "]"}]}], "}"}]}], "}"}]}], ";"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"com0", "=", 
      RowBox[{"Mean", "[", "p0", "]"}]}], ";", 
     RowBox[{"com1", "=", 
      RowBox[{"Mean", "[", "p1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"q0", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "-", "com0"}], "&"}], "/@", "p0"}]}], ";", 
     RowBox[{"q1", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "-", "com1"}], "&"}], "/@", "p1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"LeastSquares", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SparseArray", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"2", "i"}], "-", "1"}], ",", "j"}], "}"}], "->", 
               RowBox[{"q0", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"2", "i"}], ",", 
                 RowBox[{"j", "+", "1"}]}], "}"}], "->", 
               RowBox[{"q0", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "q0", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2"}], "}"}]}], "]"}], "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Flatten", "[", "q1", "]"}]}], "\[IndentingNewLine]", "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "com0", ",", "\[IndentingNewLine]", "com1", ",", "\[IndentingNewLine]", 
       
       RowBox[{"(*", 
        RowBox[{"A", "/.", 
         RowBox[{"Last", "@", 
          RowBox[{"FindMinimum", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"#", ".", "#"}], "&"}], "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"A", ".", 
                   RowBox[{"q0", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "-", 
                  RowBox[{"q1", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "[", "q0", "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"a", "[", "1", "]"}], ",", "1."}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"a", "[", "2", "]"}], ",", "0."}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"a", "[", "3", "]"}], ",", "1."}], "}"}]}], "}"}]}], 
           "]"}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"a", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"a", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"a", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"a", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "}"}]}], 
      "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.876699814653084*^9, 3.876699892207383*^9}, {
  3.87669996258911*^9, 3.876699967516334*^9}, {3.877554974163434*^9, 
  3.877554977406584*^9}, {3.877555040829709*^9, 3.877555046810443*^9}, {
  3.877555155658688*^9, 3.8775551559061527`*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"b1939b6f-50d3-4c4c-bc68-4149a3a18165"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fitLinearTransformation2D", "[", 
   RowBox[{"p0_", ",", "p1_", ",", "\"\<Symmetric\>\""}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "a", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"a", "=", 
      RowBox[{"LeastSquares", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SparseArray", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"2", "i"}], "-", "1"}], ",", "j"}], "}"}], "->", 
               RowBox[{"p0", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"2", "i"}], ",", 
                 RowBox[{"j", "+", "1"}]}], "}"}], "->", 
               RowBox[{"p0", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "p0", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2"}], "}"}]}], "]"}], "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Flatten", "[", "p1", "]"}]}], "\[IndentingNewLine]", "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"a", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"a", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"a", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"a", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8775553807935143`*^9, 3.877555445725483*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"37c8c37a-665f-4240-bbe8-9802faf1c3ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"localDeformationTensor", "[", 
    RowBox[{"c_", ",", "t0_", ",", "t1_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"patch", "=", 
       RowBox[{"Intersection", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"getNeighborhood", "[", 
          RowBox[{"c", ",", "t0", ",", "2"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Keys", "[", 
          RowBox[{"cellCentroidsTS", "[", 
           RowBox[{"[", "t0", "]"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Keys", "[", 
          RowBox[{"cellCentroidsTS", "[", 
           RowBox[{"[", "t1", "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
        "]"}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"fitDeformationMatrix", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"cellCentroidsTS", "[", 
         RowBox[{"[", "t0", "]"}], "]"}], "/@", "patch"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"cellCentroidsTS", "[", 
         RowBox[{"[", "t1", "]"}], "]"}], "/@", "patch"}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.866660260689311*^9, 3.866660416270891*^9}, {
   3.866660446278908*^9, 3.866660528016881*^9}, {3.868817175190436*^9, 
   3.868817178810091*^9}, {3.868817373131102*^9, 3.868817377722883*^9}, {
   3.868817995913862*^9, 3.868818011334474*^9}, {3.868832727976789*^9, 
   3.8688327280987387`*^9}, 3.868833085587606*^9},
 CellLabel->"In[44]:=",ExpressionUUID->"060e0f42-6a8e-4780-be1c-f5413f9eff85"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"localDeformationTensor", "[", 
    RowBox[{"c_", ",", "t0_", ",", "t1_", ",", "\"\<Tangential\>\""}], "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"patch", "=", 
        RowBox[{"Intersection", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"getNeighborhood", "[", 
           RowBox[{"c", ",", "t0", ",", "2"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Keys", "[", 
           RowBox[{"cellCentroidsTS", "[", 
            RowBox[{"[", "t0", "]"}], "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Keys", "[", 
           RowBox[{"cellCentroidsTS", "[", 
            RowBox[{"[", "t1", "]"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
         "]"}]}], ",", "\[IndentingNewLine]", "c0", ",", "c1", ",", "n0", ",",
        "n1"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c0", "=", 
       RowBox[{
        RowBox[{"cellCentroidsTS", "[", 
         RowBox[{"[", "t0", "]"}], "]"}], "/@", "patch"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"c1", "=", 
       RowBox[{
        RowBox[{"cellCentroidsTS", "[", 
         RowBox[{"[", "t1", "]"}], "]"}], "/@", "patch"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n0", "=", 
       RowBox[{
        RowBox[{"findLocalBasis", "[", "c0", "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n1", "=", 
       RowBox[{
        RowBox[{"findLocalBasis", "[", "c1", "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fitDeformationMatrix", "[", 
       RowBox[{"c0", ",", "c1", ",", "n0", ",", "n1"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8688321989446077`*^9, 3.868832202157736*^9}, {
   3.868832304515871*^9, 3.868832344869585*^9}, {3.8688324651464663`*^9, 
   3.868832494349317*^9}, {3.868832729554906*^9, 3.868832729653963*^9}, 
   3.868833087144191*^9, {3.868904139462039*^9, 3.868904212793353*^9}, {
   3.868904327223339*^9, 3.868904338515811*^9}, {3.877634071543889*^9, 
   3.8776340740233307`*^9}, 3.8776341289103193`*^9},
 CellLabel->"In[45]:=",ExpressionUUID->"f9d9493b-634e-46e2-b384-4d8347c7884e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"polarDecomposition", "[", "A_", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"usv", "=", 
      RowBox[{"SingularValueDecomposition", "[", "A", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"usv", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ".", 
       RowBox[{"usv", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ".", 
       RowBox[{"Transpose", "[", 
        RowBox[{"usv", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{"usv", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ".", 
       RowBox[{"Transpose", "[", 
        RowBox[{"usv", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}]}]}], "}"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.867030404494463*^9, 3.8670304136776114`*^9}, {
   3.8670304464184647`*^9, 3.867030469063891*^9}, 3.867030595905365*^9, {
   3.8670306621325274`*^9, 3.867030723842239*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"5b564ae3-2b1a-48b6-b8be-e672f74fcbfc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"transportLocalBasis", "[", 
    RowBox[{"c_Integer", ",", "t0_Integer", ",", "t1_Integer"}], "]"}], ":=", 
   
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"basis", "=", 
        RowBox[{"findLocalBasis", "[", 
         RowBox[{"vertexCoordsTS", "[", 
          RowBox[{"[", 
           RowBox[{"t0", ",", 
            RowBox[{
             RowBox[{"cellVerticesTS", "[", 
              RowBox[{"[", "t0", "]"}], "]"}], "[", "c", "]"}]}], "]"}], 
          "]"}], "]"}]}], ",", "\[IndentingNewLine]", "com0", ",", "com1", 
       ",", "L", ",", "\[IndentingNewLine]", "R"}], "\[IndentingNewLine]", 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"com0", ",", "com1", ",", "L"}], "}"}], "=", 
       RowBox[{"localDeformationTensor", "[", 
        RowBox[{"c", ",", "t0", ",", "t1", ",", "\"\<Tangential\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"R", "=", 
       RowBox[{
        RowBox[{"polarDecomposition", "[", "L", "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"com0", ",", "com1", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"R", ".", "#"}], "&"}], "/@", "basis"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.868816982284461*^9, 3.868817104426503*^9}, {
   3.86881718629907*^9, 3.868817247680421*^9}, {3.8688173862339354`*^9, 
   3.868817441174654*^9}, {3.868817492737479*^9, 3.868817508375113*^9}, {
   3.868818264311338*^9, 3.868818298226028*^9}, {3.86881838911187*^9, 
   3.868818405151767*^9}, 3.8688185019516773`*^9, {3.8688185709105062`*^9, 
   3.8688185780461187`*^9}, {3.868819217168706*^9, 3.86881922155618*^9}, {
   3.8688193771027727`*^9, 3.868819381266554*^9}, {3.868819441066173*^9, 
   3.868819495217046*^9}, {3.8688195463606787`*^9, 3.8688195809354267`*^9}, 
   3.8688328001962757`*^9, {3.868904353658654*^9, 3.86890436493757*^9}, {
   3.877634145218713*^9, 3.8776341486261787`*^9}, {3.878149893595457*^9, 
   3.878149928251481*^9}, {3.8781499674442368`*^9, 3.878149994183589*^9}, 
   3.88982403664037*^9, {3.935968595087681*^9, 3.935968595421885*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"2c3e74b8-0784-40e1-8392-ce4047c11a43"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Vertex geometry", "Subsubsection",
 CellChangeTimes->{{3.86475269558471*^9, 
  3.8647526975146093`*^9}},ExpressionUUID->"c3e798d1-d63e-4d15-baa0-\
7db35588ea09"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "vertexTensions", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"vertexTensions", "::", "usage"}], "=", 
    "\"\<Inferes the tensions from the angles at a vertex. The tensions \
correspond to the edge opposite to the respective angle.\>\""}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"vertexTensions", "[", 
     RowBox[{"angles", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"_", "?", "NumberQ"}], ".."}], "}"}]}], "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"sines", "=", 
        RowBox[{"Sin", "[", "angles", "]"}]}], "\[IndentingNewLine]", "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"3.", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", 
               RowBox[{"#", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ")"}]}]}], "&"}], "@", 
          RowBox[{"RotateLeft", "[", 
           RowBox[{"sines", ",", "#"}], "]"}]}], ")"}], "&"}], "/@", 
       RowBox[{"{", 
        RowBox[{"2", ",", "0", ",", "1"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vertexTensions", "[", 
   RowBox[{"angles", ":", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"_", "?", "NumericQ"}], ".."}], "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"3.", 
     RowBox[{"#", "/", 
      RowBox[{"Total", "[", "#", "]"}]}]}], "&"}], "@", 
   RowBox[{"Sin", "[", "angles", "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.8644217076754637`*^9, 3.86442174800321*^9}, {
  3.872530253192174*^9, 3.8725302651744423`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"590e420b-e816-460e-ad01-4412bd5d64bd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vertexAngles", "[", 
   RowBox[{"v_Integer", ",", "t_Integer", ",", "\"\<Raw\>\""}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x0", "=", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", "v"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      
      RowBox[{"xi", "=", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", 
          RowBox[{"vertexNeighborsTS", "[", 
           RowBox[{"[", 
            RowBox[{"t", ",", "v"}], "]"}], "]"}]}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"vecs", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Normalize", "[", 
           RowBox[{"#", "-", "x0"}], "]"}], "&"}], "/@", "xi"}]}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Re", "@", 
           RowBox[{"ArcCos", "[", 
            RowBox[{"Dot", "@@", "#"}], "]"}]}], "&"}], "/@", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{"RotateLeft", "[", "#", "]"}]}], "}"}], "]"}]}], "&"}], 
       "@", "vecs"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 CellChangeTimes->{{3.8644103033303823`*^9, 3.864410331684236*^9}, {
  3.864587051443864*^9, 3.864587070107977*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"76b6e31e-c1ca-42d6-83bc-30fb23b9a1c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vertexAngles", "[", 
   RowBox[{"v_Integer", ",", "t_Integer"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x0", "=", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", "v"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      
      RowBox[{"xi", "=", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", 
          RowBox[{"vertexNeighborsTS", "[", 
           RowBox[{"[", 
            RowBox[{"t", ",", "v"}], "]"}], "]"}]}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"vecs", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Normalize", "[", 
            RowBox[{"#", "-", "x0"}], "]"}], "&"}], "/@", "xi"}]}], ",", 
        RowBox[{"normalVec", "=", 
         RowBox[{
          RowBox[{"findLocalBasis", "[", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", "x0", "}"}], ",", "xi"}], "]"}], "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Re", "@", 
           RowBox[{"ArcCos", "[", 
            RowBox[{"Dot", "@@", "#"}], "]"}]}], "&"}], "/@", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"#", ",", 
            RowBox[{"RotateLeft", "[", "#", "]"}]}], "}"}], "]"}]}], "&"}], 
       "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Normalize", "[", 
           RowBox[{"#", "-", 
            RowBox[{"normalVec", " ", 
             RowBox[{"normalVec", ".", "#"}]}]}], "]"}], "&"}], "/@", 
         "vecs"}], ")"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.864586522174739*^9, 3.864586537082782*^9}, {
  3.864586714744175*^9, 3.8645867594560137`*^9}, {3.864586793520198*^9, 
  3.864586840159028*^9}, {3.864587031812604*^9, 3.864587044724224*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"4a735b89-9a96-4020-bc23-ce78894fd46a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vertexVecs", "[", 
   RowBox[{"v_Integer", ",", "t_Integer"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x0", "=", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", "v"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      
      RowBox[{"xi", "=", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", 
          RowBox[{"vertexNeighborsTS", "[", 
           RowBox[{"[", 
            RowBox[{"t", ",", "v"}], "]"}], "]"}]}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"normalVec", "=", 
        RowBox[{
         RowBox[{"findLocalBasis", "[", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "x0", "}"}], ",", "xi"}], "]"}], "]"}], "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{
        RowBox[{"Normalize", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"#", "-", "x0"}], ")"}], "-", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", "-", "x0"}], ")"}], ".", "normalVec"}], " ", 
           "normalVec"}]}], "]"}], "&"}], "/@", "xi"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->"In[18]:=",ExpressionUUID->"0aacec08-d087-465f-9956-e0baf2333d73"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vertexVecs", "[", 
   RowBox[{"v_Integer", ",", "t_Integer", ",", "\"\<NotNormalized\>\""}], 
   "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x0", "=", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", "v"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      
      RowBox[{"xi", "=", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", 
          RowBox[{"vertexNeighborsTS", "[", 
           RowBox[{"[", 
            RowBox[{"t", ",", "v"}], "]"}], "]"}]}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"normalVec", "=", 
        RowBox[{
         RowBox[{"findLocalBasis", "[", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "x0", "}"}], ",", "xi"}], "]"}], "]"}], "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#", "-", "x0"}], ")"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"#", "-", "x0"}], ")"}], ".", "normalVec"}], " ", 
          "normalVec"}]}], "&"}], "/@", "xi"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.864597165233117*^9, 3.8645971847204437`*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"6fe6d71e-5bf8-4236-8c49-f84254f69182"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dualShapeTensor", "[", "vecs_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"angles", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Re", "@", 
            RowBox[{"ArcCos", "[", 
             RowBox[{"Dot", "@@", "#"}], "]"}]}], "&"}], "/@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{"RotateLeft", "[", "#", "]"}]}], "}"}], "]"}]}], "&"}], 
        "@", "vecs"}]}], ",", "\[IndentingNewLine]", "T", ",", "Tvecs", ",", 
      "S"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Total", "[", "angles", "]"}], "<", 
        RowBox[{
         RowBox[{"2", "\[Pi]"}], "-", "0.001"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateAngles\>\"", ",", "angles"}], "]"}], "]"}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"T", "=", 
      RowBox[{"RotateLeft", "[", 
       RowBox[{"Re", "@", 
        RowBox[{"vertexTensions", "[", "angles", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Tvecs", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"[", "i", "]"}], "]"}], 
         RowBox[{"vecs", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "3"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"S", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", ".", 
          RowBox[{"Transpose", "[", "#", "]"}]}], "/", "2"}], "&"}], "@", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Tvecs", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "-", 
          RowBox[{"Tvecs", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{
          SqrtBox["3"], 
          RowBox[{"Tvecs", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", "S"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.864340249050836*^9, 3.864340250170485*^9}, {
  3.864340290826036*^9, 3.8643403761048927`*^9}, {3.864340415840721*^9, 
  3.864340458024535*^9}, {3.86434056284694*^9, 3.864340592769014*^9}, {
  3.864340622933237*^9, 3.864340767245181*^9}, {3.8643407983884583`*^9, 
  3.864340798467823*^9}, {3.8643408471164093`*^9, 3.864340855924223*^9}, {
  3.864341617514326*^9, 3.864341623136924*^9}, {3.864589004835382*^9, 
  3.864589028307538*^9}, {3.864589061522457*^9, 3.8645891692050247`*^9}, {
  3.864589223624311*^9, 3.8645892499177094`*^9}, {3.86459167828157*^9, 
  3.864591679960891*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"037e862c-f9de-4015-81ea-379bc0882d03"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dualShapeTensors", "[", "vecs_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"angles", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Re", "@", 
            RowBox[{"ArcCos", "[", 
             RowBox[{"Dot", "@@", "#"}], "]"}]}], "&"}], "/@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{"RotateLeft", "[", "#", "]"}]}], "}"}], "]"}]}], "&"}], 
        "@", "vecs"}]}], ",", "\[IndentingNewLine]", "T", ",", "Tvecs"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Total", "[", "angles", "]"}], "<", 
        RowBox[{
         RowBox[{"2", "\[Pi]"}], "-", "0.001"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateAngles\>\"", ",", "angles"}], "]"}], "]"}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"T", "=", 
      RowBox[{"RotateLeft", "[", 
       RowBox[{"Re", "@", 
        RowBox[{"vertexTensions", "[", "angles", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Tvecs", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"[", "i", "]"}], "]"}], 
         RowBox[{"vecs", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "3"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Physical", " ", 
        RowBox[{"(", " ", 
         RowBox[{"=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Transpose", "[", "#", "]"}], ".", "#"}], "/", "2"}], 
            "&"}], "@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"Tvecs", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", 
              RowBox[{"Tvecs", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{
              SqrtBox["3"], 
              RowBox[{"Tvecs", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], ")"}]}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"t", "\[TensorProduct]", "t"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "Tvecs"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", "Dual", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", ".", 
           RowBox[{"Transpose", "[", "#", "]"}]}], "/", "2"}], "&"}], "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Tvecs", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", 
           RowBox[{"Tvecs", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", 
          RowBox[{
           SqrtBox["3"], 
           RowBox[{"Tvecs", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}]}], 
      "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.866112712513998*^9, 3.866112718123667*^9}, {
   3.8661128930228987`*^9, 3.866112924735189*^9}, {3.866112959266728*^9, 
   3.866112989711894*^9}, {3.866113025008233*^9, 3.86611303622021*^9}, {
   3.866113277010687*^9, 3.866113282108333*^9}, 3.866113557587117*^9, {
   3.866113598637622*^9, 3.866113598922085*^9}, {3.866113629994573*^9, 
   3.866113679548896*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"b3ff6a02-ca3d-4691-a8a7-784bfa8ddae1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"arcTan", "[", 
   RowBox[{"0.", ",", "0."}], "]"}], ":=", "0"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"arcTan", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
  RowBox[{"ArcTan", "[", 
   RowBox[{"x", ",", "y"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.8643418137605257`*^9, 3.8643418380453978`*^9}, {
   3.8643977057985497`*^9, 3.864397723349434*^9}, 3.864576598242593*^9},
 CellLabel->"In[22]:=",ExpressionUUID->"33b33cbc-9fee-4dc6-99f3-e53974f544e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"shapeMagPhase", "[", "vecs_", "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"S", "=", 
       RowBox[{"dualShapeTensor", "[", "vecs", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MissingQ", "[", "S", "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1."}], ",", "0."}], "}"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"S", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
              RowBox[{"S", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}], "2"], "+", 
           RowBox[{"4", 
            SuperscriptBox[
             RowBox[{"S", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2"}], "]"}], "]"}], "2"]}]}]], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"S", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
           RowBox[{"S", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", "$MachineEpsilon"}], 
          ")"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{"3", 
             RowBox[{"(", 
              RowBox[{"\[Pi]", "+", 
               RowBox[{"arcTan", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"S", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                   RowBox[{"S", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}], ",", 
                 RowBox[{"2", 
                  RowBox[{"S", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "]"}]}], 
              ")"}]}], ",", 
            RowBox[{"2", "\[Pi]"}]}], "]"}], "-", "\[Pi]"}], "]"}]}], 
       "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8644971532170773`*^9, 3.8644972027101*^9}, {
  3.864497443390679*^9, 3.864497443938665*^9}, {3.864589277631907*^9, 
  3.864589312983403*^9}, {3.864660856383768*^9, 3.8646608599662743`*^9}, {
  3.864661018720783*^9, 3.86466102120164*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"96a8c17b-7a1c-4fcb-be83-b9d4f60d9962"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"shapeMagPhaseDir", "[", "vecs_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"S", ",", "T"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MissingQ", "[", "#", "]"}], ",", 
          RowBox[{"Return", "[", "#", "]"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"T", ",", "S"}], "}"}], "=", "#"}]}], "]"}], "&"}], "@", 
       RowBox[{"dualShapeTensors", "[", "vecs", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"S", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
              RowBox[{"S", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}], "2"], "+", 
           RowBox[{"4", 
            SuperscriptBox[
             RowBox[{"S", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2"}], "]"}], "]"}], "2"]}]}]], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"S", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
           RowBox[{"S", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}], "+", "$MachineEpsilon"}], 
          ")"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"Mod", "[", 
           RowBox[{
            RowBox[{"3", 
             RowBox[{"(", 
              RowBox[{"\[Pi]", "+", 
               RowBox[{"arcTan", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"S", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", 
                   RowBox[{"S", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}], ",", 
                 RowBox[{"2", 
                  RowBox[{"S", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "]"}]}], 
              ")"}]}], ",", 
            RowBox[{"2", "\[Pi]"}]}], "]"}], "-", "\[Pi]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"MaximalBy", "[", 
          RowBox[{
           RowBox[{"Transpose", "@", 
            RowBox[{"Eigensystem", "[", "T", "]"}]}], ",", "First"}], "]"}], 
         "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
       "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.866113717560624*^9, 3.866113812922616*^9}, {
  3.8661138500296917`*^9, 3.866113867694716*^9}, {3.866113918546628*^9, 
  3.866113921975649*^9}, {3.8661140172749567`*^9, 3.866114019741776*^9}, {
  3.866114081930793*^9, 3.8661141069349337`*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"4c551906-40c4-4559-baad-b1229c94ecaa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"vertexLocalBasis", "[", 
    RowBox[{"v_", ",", "t_"}], "]"}], ":=", 
   RowBox[{"findLocalBasis", "[", 
    RowBox[{"vertexCoordsTS", "[", 
     RowBox[{"[", 
      RowBox[{"t", ",", 
       RowBox[{"vertexNeighborsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", "v"}], "]"}], "]"}]}], "]"}], "]"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8661152870144453`*^9, 3.8661153181906*^9}, {
  3.86611536099822*^9, 3.866115383408947*^9}},
 CellLabel->"In[26]:=",ExpressionUUID->"3fe24a84-b25a-4717-8ed3-a1bc7e0dd9af"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Quartet tension inference", "Subsubsection",
 CellChangeTimes->{{3.8902003192030363`*^9, 
  3.890200322590156*^9}},ExpressionUUID->"5ee124f1-3f3f-4fdd-b776-\
8c2db014e3af"],

Cell[BoxData[
 RowBox[{
  RowBox[{"edgeNeighborProperties", "[", 
   RowBox[{
    RowBox[{"cellPair", ":", 
     RowBox[{"{", 
      RowBox[{"_Integer", ".."}], "}"}]}], ",", "t_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cellVertices", "=", 
       RowBox[{
        RowBox[{"cellVerticesTS", "[", 
         RowBox[{"[", "t", "]"}], "]"}], "/@", "cellPair"}]}], ",", 
      "\[IndentingNewLine]", "vertexPair", ",", "neighbors", ",", 
      RowBox[{"vertices", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", "6"}], "]"}]}], ",", "\[IndentingNewLine]", 
      "coords"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"cellNeighborsTS", "[", 
            RowBox[{"[", "t", "]"}], "]"}], "[", 
           RowBox[{"cellPair", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
          RowBox[{"cellPair", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<NoEdge\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"cellPair", ",", "t"}], "}"}]}], "]"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"cellVertices", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "<", "3"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateCell\>\"", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"cellPair", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "t"}], "}"}]}], "]"}], 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"cellVertices", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "<", "3"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateCell\>\"", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"cellPair", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "t"}], "}"}]}], "]"}], 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertexPair", "=", 
      RowBox[{"sharedVertices", "[", 
       RowBox[{"cellPair", ",", "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vertexPair", "]"}], "!=", "2"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateEdge\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"cellPair", ",", "t"}], "}"}]}], "]"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vertices", "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", "2"}], "]"}], "]"}], "=", "vertexPair"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"neighbors", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"vertexNeighborsTS", "[", 
         RowBox[{"[", 
          RowBox[{"t", ",", 
           RowBox[{"vertexPair", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], ",", 
        RowBox[{"vertexPair", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "neighbors", "]"}], "!=", "2"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateVertex\>\"", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vertexPair", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "t"}], "}"}]}], "]"}], 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vertices", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "=", 
      RowBox[{"First", "[", 
       RowBox[{"Intersection", "[", 
        RowBox[{"neighbors", ",", 
         RowBox[{"cellVertices", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vertices", "[", 
       RowBox[{"[", "4", "]"}], "]"}], "=", 
      RowBox[{"First", "[", 
       RowBox[{"Intersection", "[", 
        RowBox[{"neighbors", ",", 
         RowBox[{"cellVertices", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"neighbors", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"vertexNeighborsTS", "[", 
         RowBox[{"[", 
          RowBox[{"t", ",", 
           RowBox[{"vertexPair", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
        RowBox[{"vertexPair", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "neighbors", "]"}], "!=", "2"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateVertex\>\"", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vertexPair", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "t"}], "}"}]}], "]"}], 
        "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vertices", "[", 
       RowBox[{"[", "5", "]"}], "]"}], "=", 
      RowBox[{"First", "[", 
       RowBox[{"Intersection", "[", 
        RowBox[{"neighbors", ",", 
         RowBox[{"cellVertices", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vertices", "[", 
       RowBox[{"[", "6", "]"}], "]"}], "=", 
      RowBox[{"First", "[", 
       RowBox[{"Intersection", "[", 
        RowBox[{"neighbors", ",", 
         RowBox[{"cellVertices", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"coords", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"project", "[", 
         RowBox[{"#", ",", 
          RowBox[{"findTangentSpace", "[", "#", "]"}]}], "]"}], "&"}], "@", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", "vertices"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "vertices", ",", "\[IndentingNewLine]", "coords", ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Edge", " ", "lengths"}], " ", "*)"}], "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{
         RowBox[{"Norm", "/@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"#", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"#", "[", 
              RowBox[{"[", "5", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"#", "[", 
              RowBox[{"[", "6", "]"}], "]"}]}]}], "}"}]}], "&"}], "@", 
        "coords"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Inner", " ", "angles"}], " ", "*)"}], "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{
         RowBox[{"threePointAngle", "[", 
          RowBox[{"coords", "[", 
           RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "4"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "6"}], "}"}]}], "}"}]}]}], 
      "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.859590094498012*^9, 3.859590152545415*^9}, {
  3.859590255192792*^9, 3.8595902640958567`*^9}, {3.859659056423355*^9, 
  3.8596590695681334`*^9}, {3.859659144245682*^9, 3.85965919605186*^9}, {
  3.859659232746151*^9, 3.859659271338125*^9}, {3.859659324254961*^9, 
  3.859659375056859*^9}, {3.8596619056338663`*^9, 3.859661926582012*^9}, {
  3.859662911166779*^9, 3.8596629119994926`*^9}, {3.8604358154927073`*^9, 
  3.860435882707365*^9}, {3.865295256871162*^9, 3.8652953673843203`*^9}, {
  3.865295441915021*^9, 3.865295444478684*^9}, {3.866234273959876*^9, 
  3.8662342902495193`*^9}, {3.8662343221815157`*^9, 3.8662343420492907`*^9}, {
  3.866767526953649*^9, 3.8667675355624123`*^9}, {3.868054434917486*^9, 
  3.868054527046277*^9}, {3.86822313594236*^9, 3.8682231376525373`*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"6133604d-80b0-4f7f-bdc4-ca32113bc22d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"quartetEdgeTension", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Alpha]12_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ",", 
     RowBox[{"\[Alpha]13_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ",", 
     RowBox[{"\[Alpha]14_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ",", 
     RowBox[{"\[Alpha]15_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}]}], "}"}], "]"}], 
  ":=", 
  RowBox[{"N", "[", 
   RowBox[{
    RowBox[{"-", "4"}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       FractionBox[
        RowBox[{
         RowBox[{"Sin", "[", "\[Alpha]12", "]"}], "+", 
         RowBox[{"Sin", "[", "\[Alpha]13", "]"}]}], 
        RowBox[{" ", 
         RowBox[{"Sin", "[", 
          RowBox[{"\[Alpha]12", "+", "\[Alpha]13"}], "]"}]}]], "+", 
       FractionBox[
        RowBox[{
         RowBox[{"Sin", "[", "\[Alpha]14", "]"}], "+", 
         RowBox[{"Sin", "[", "\[Alpha]15", "]"}]}], 
        RowBox[{"Sin", "[", 
         RowBox[{"\[Alpha]14", "+", "\[Alpha]15"}], "]"}]]}], ")"}], 
     RowBox[{"-", "1"}]]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.867706633118362*^9, 3.867706634467524*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"def3c949-c7aa-479e-aa8b-19b211b98ac1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"quartetEdgeTensions", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Alpha]01_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ",", 
     RowBox[{"\[Alpha]02_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ",", 
     RowBox[{"\[Alpha]03_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ",", 
     RowBox[{"\[Alpha]04_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"NumberQ", "[", 
         RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}]}], "}"}], "]"}], 
  ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "/", 
     RowBox[{"Mean", "[", 
      RowBox[{"Rest", "[", "#", "]"}], "]"}]}], "&"}], "@", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Sin", "[", 
        RowBox[{"\[Alpha]01", "+", "\[Alpha]02"}], "]"}]}], 
      RowBox[{"Sin", "[", 
       RowBox[{"\[Alpha]03", "+", "\[Alpha]04"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Sin", "[", "\[Alpha]02", "]"}], 
      RowBox[{"Sin", "[", 
       RowBox[{"\[Alpha]03", "+", "\[Alpha]04"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Sin", "[", "\[Alpha]01", "]"}], 
      RowBox[{"Sin", "[", 
       RowBox[{"\[Alpha]03", "+", "\[Alpha]04"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Sin", "[", 
       RowBox[{"\[Alpha]01", "+", "\[Alpha]02"}], "]"}], 
      RowBox[{"Sin", "[", "\[Alpha]04", "]"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Sin", "[", 
       RowBox[{"\[Alpha]01", "+", "\[Alpha]02"}], "]"}], 
      RowBox[{"Sin", "[", "\[Alpha]03", "]"}]}]}], "\[IndentingNewLine]", 
    "}"}]}]}]], "Input",
 CellChangeTimes->{{3.87798528695619*^9, 3.877985290542878*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"8d3a377f-15ef-4ece-b834-88d497d4c203"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Polygon/cell shape tensor", "Subsubsection",
 CellChangeTimes->{{3.867348857040854*^9, 
  3.867348871630622*^9}},ExpressionUUID->"cb017957-cc1c-4e4c-880c-\
58de66589fe4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"polygonShapeTensor2D", "::", "usage"}], "=", 
   "\"\<Returns a tensor whose eigenvalues are the radii of the best fitting \
ellipse.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"polygonShapeTensor2D", "[", 
   RowBox[{"coords_", ",", "area_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"Q", "=", 
      RowBox[{"Mean", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[TensorProduct]", "#"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"coords", "-", 
          RowBox[{"RotateLeft", "[", "coords", "]"}]}], ")"}]}], "]"}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "We", " ", "are", " ", "effectively", " ", "taking", " ", "the", " ", 
      "squareroot", " ", "of", " ", "the", " ", "matrix", " ", "here"}], " ", 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{"Total", "[", 
     RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"#1", 
         RowBox[{"#2", "\[TensorProduct]", "#2"}]}], "&"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           SqrtBox[
            RowBox[{"area", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "/", 
              RowBox[{"(", 
               RowBox[{"\[Pi]", 
                SqrtBox[
                 RowBox[{"Times", "@@", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}]]}], ")"}]}]}]], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "@", 
        RowBox[{"Eigensystem", "[", "Q", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"MatrixPower", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"area", "/", 
        RowBox[{"(", 
         RowBox[{"\[Pi]", " ", 
          SqrtBox[
           RowBox[{"Det", "[", "Q", "]"}]]}], ")"}]}], "Q"}], ",", 
      RowBox[{"1", "/", "2"}]}], "]"}], "*)"}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8670976847506313`*^9, 3.867097717609865*^9}, {
   3.867097763098287*^9, 3.867097784641144*^9}, {3.867098124552544*^9, 
   3.86709815492517*^9}, {3.867098274999134*^9, 3.8670982910907383`*^9}, {
   3.8674306574245*^9, 3.867430658814582*^9}, 3.8674307136726637`*^9, {
   3.86743078909*^9, 3.867430809642522*^9}, {3.867431027758093*^9, 
   3.867431082313037*^9}, {3.86743126140154*^9, 3.867431262438794*^9}, {
   3.867432505519712*^9, 3.867432641486784*^9}, {3.8715752112931137`*^9, 
   3.87157521407561*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"576e8e8f-cc04-4614-905e-254e28778ea9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"polygonShapeTensor2D", "[", "coords_", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"Q", "=", 
      RowBox[{"Mean", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[TensorProduct]", "#"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"coords", "-", 
          RowBox[{"RotateLeft", "[", "coords", "]"}]}], ")"}]}], "]"}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Total", "[", 
      RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", 
          RowBox[{"#2", "\[TensorProduct]", "#2"}]}], "&"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            SqrtBox[
             RowBox[{"area", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "/", 
               RowBox[{"(", 
                RowBox[{"\[Pi]", 
                 SqrtBox[
                  RowBox[{"Times", "@@", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]]}], ")"}]}]}]], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "@", 
         RowBox[{"Eigensystem", "[", "Q", "]"}]}]}], "\[IndentingNewLine]", 
       "]"}], "]"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     SqrtBox[
      RowBox[{
       RowBox[{"polygonArea", "[", "coords", "]"}], "/", 
       RowBox[{"(", 
        RowBox[{"\[Pi]", " ", 
         RowBox[{"Det", "[", "Q", "]"}]}], ")"}]}]], "Q"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.867430863033266*^9, 3.867430891205935*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"9066bcc4-de5a-4b67-b24c-d0190ad5b7f8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Tension-isogonal decomposition", "Subsubsection",
 CellChangeTimes->{{3.922050247738038*^9, 
  3.922050253168305*^9}},ExpressionUUID->"bb3a9d2d-c939-4486-a3ff-\
456a85719195"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getTripletCoords", "[", 
   RowBox[{
    RowBox[{"triplet", ":", 
     RowBox[{"{", 
      RowBox[{"_Integer", ",", "_Integer", ",", "_Integer"}], "}"}]}], ",", 
    "t_Integer"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cv", "=", 
       RowBox[{
        RowBox[{"cellVerticesTS", "[", 
         RowBox[{"[", "t", "]"}], "]"}], "/@", "triplet"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"centroids", "=", 
       RowBox[{
        RowBox[{"cellCentroidsTS", "[", 
         RowBox[{"[", "t", "]"}], "]"}], "/@", "triplet"}]}], ",", 
      "\[IndentingNewLine]", "edges", ",", "\[IndentingNewLine]", "v0", ",", 
      "x0", ",", "xi", ",", "\[IndentingNewLine]", "basis"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"basis", "=", 
      RowBox[{"findLocalBasis", "[", "centroids", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Fix", " ", "chirality"}], " ", "*)"}], " ", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Cross", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"centroids", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{"centroids", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"centroids", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"centroids", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ".", 
         RowBox[{"basis", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "<", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"cv", "=", 
         RowBox[{"Reverse", "[", "cv", "]"}]}], ";", 
        RowBox[{"centroids", "=", 
         RowBox[{"Reverse", "[", "centroids", "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"edges", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Intersection", "@@", "#"}], "&"}], "/@", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"cv", ",", 
          RowBox[{"RotateLeft", "[", "cv", "]"}]}], "}"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Length", "/@", "edges"}], ")"}], "=!=", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateVertex\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "t"}], "}"}]}], "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"v0", "=", 
      RowBox[{"First", "@", 
       RowBox[{"(", 
        RowBox[{"Intersection", "@@", "edges"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"x0", "=", 
      RowBox[{"vertexCoordsTS", "[", 
       RowBox[{"[", 
        RowBox[{"t", ",", "v0"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"xi", "=", 
      RowBox[{"vertexCoordsTS", "[", 
       RowBox[{"[", 
        RowBox[{"t", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{"#", ",", "v0"}], "]"}], "]"}], "&"}], "/@", "edges"}]}],
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", "-", "x0"}], ")"}], ".", 
            RowBox[{"basis", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", "-", "x0"}], ")"}], ".", 
            RowBox[{"basis", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "&"}], "/@", 
        "centroids"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", "-", "x0"}], ")"}], ".", 
            RowBox[{"basis", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", "-", "x0"}], ")"}], ".", 
            RowBox[{"basis", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "&"}], "/@", "xi"}]}],
       "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.864659149528021*^9, 3.864659219880618*^9}, {
   3.864659373133466*^9, 3.8646594326916943`*^9}, {3.8646594857002277`*^9, 
   3.864659487040944*^9}, {3.864659523944796*^9, 3.864659682124421*^9}, {
   3.8646597242427807`*^9, 3.8646597618993692`*^9}, {3.864660078323536*^9, 
   3.8646601106608343`*^9}, {3.864660194954578*^9, 3.8646602146394243`*^9}, 
   3.864660303480383*^9, {3.864660382975018*^9, 3.864660496373807*^9}, {
   3.8666624859822683`*^9, 3.866662531889436*^9}, {3.866662562037589*^9, 
   3.866662625250883*^9}, {3.866662989739757*^9, 3.866663014377759*^9}, {
   3.8666630809656553`*^9, 3.8666630869003487`*^9}, {3.866663230283916*^9, 
   3.866663243523016*^9}, {3.8725243911793633`*^9, 3.872524502611268*^9}, {
   3.872532013143641*^9, 3.872532063505129*^9}, {3.872532106913415*^9, 
   3.872532111809257*^9}, {3.8725982066714983`*^9, 3.872598219578068*^9}, {
   3.872600364940443*^9, 3.872600370284555*^9}, {3.872601819761894*^9, 
   3.872601850206524*^9}, {3.872602020881562*^9, 3.8726020210662117`*^9}, {
   3.9220520929086637`*^9, 3.922052134985414*^9}, {3.922052180316098*^9, 
   3.9220521835202293`*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"c432d8aa-77cf-4ab2-95e7-b2c386cf71ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tensionTriangle", "[", "vecs_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"angles", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Re", "@", 
            RowBox[{"ArcCos", "[", 
             RowBox[{"Dot", "@@", "#"}], "]"}]}], "&"}], "/@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{"RotateLeft", "[", "#", "]"}]}], "}"}], "]"}]}], "&"}], 
        "@", "vecs"}]}], ",", "\[IndentingNewLine]", "T", ",", "Tvecs"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Total", "[", "angles", "]"}], "<", 
        RowBox[{
         RowBox[{"2", "\[Pi]"}], "-", "0.001"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateAngles\>\"", ",", "vecs"}], "]"}], "]"}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"T", "=", 
      RowBox[{"RotateLeft", "[", 
       RowBox[{"Re", "@", 
        RowBox[{"vertexTensions", "[", "angles", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Or", "@@", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Sign", "[", "T", "]"}], "<", "0"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateAngles\>\"", ",", "vecs"}], "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Tvecs", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", 
          RowBox[{"[", "i", "]"}], "]"}], 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "0"}], "}"}]}], "}"}], ".", 
          RowBox[{"vecs", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "3"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], "-", "#"}], ",", 
         RowBox[{
          RowBox[{"Tvecs", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "-", "#"}], ",", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Tvecs", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "-", "#"}]}], "}"}], "&"}], "@", 
      RowBox[{"Mean", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"Tvecs", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"-", 
          RowBox[{"Tvecs", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8725254142383327`*^9, 3.872525420087036*^9}, {
   3.8725303253180847`*^9, 3.872530342026354*^9}, {3.8725305315720577`*^9, 
   3.872530534836006*^9}, {3.8725314119358807`*^9, 3.8725315250424557`*^9}, {
   3.872531694607708*^9, 3.8725316994342947`*^9}, {3.872531798031651*^9, 
   3.872531801382696*^9}, {3.8725967533646927`*^9, 3.87259675677216*^9}, {
   3.872601135634116*^9, 3.872601140922138*^9}, 3.872601194533656*^9, {
   3.872601676831582*^9, 3.8726017101638308`*^9}, {3.872601899237088*^9, 
   3.872601995582896*^9}, {3.8726021133963947`*^9, 3.872602138453916*^9}, {
   3.872602177487916*^9, 3.872602206610196*^9}, {3.872602981936202*^9, 
   3.87260298720393*^9}, {3.872606247829398*^9, 3.8726063414651423`*^9}, {
   3.872608136338091*^9, 3.872608137190981*^9}, {3.872608172742354*^9, 
   3.872608173020153*^9}, {3.878431290282177*^9, 3.878431291962875*^9}, 
   3.8897358902055817`*^9},
 CellLabel->"In[51]:=",ExpressionUUID->"c3bc7c8d-6181-4334-893b-c40937d78b88"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vertexTensionTriangle", "[", 
   RowBox[{"v_Integer", ",", "t_Integer"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"triplet", "=", 
       RowBox[{"vertexCellsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", "v"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      "coords", ",", "\[IndentingNewLine]", "tCoords", ",", "A"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "triplet", "]"}], "!=", "3"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateVertex\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "t"}], "}"}]}], "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"coords", "=", 
      RowBox[{"getTripletCoords", "[", 
       RowBox[{"triplet", ",", "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MissingQ", "[", "coords", "]"}], ",", 
       RowBox[{"Return", "[", "coords", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{"Norm", "/@", 
          RowBox[{"coords", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "<", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<ShortEdge\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "t"}], "}"}]}], "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tensionTriangle", "[", 
      RowBox[{"Normalize", "/@", 
       RowBox[{"coords", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.872608514314391*^9, 3.872608584569058*^9}, 
   3.889735890217502*^9, {3.922052156794033*^9, 3.922052199724279*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"b0290340-6943-4931-b0a3-dcc5992ebc3c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"triArea", "[", 
   RowBox[{"e1_", ",", "e2_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Abs", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"e1", "[", 
       RowBox[{"[", "1", "]"}], "]"}], 
      RowBox[{"e2", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "-", 
     RowBox[{
      RowBox[{"e1", "[", 
       RowBox[{"[", "2", "]"}], "]"}], 
      RowBox[{"e2", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "/", "2"}]}]], "Input",
 CellChangeTimes->{{3.871860282391489*^9, 3.87186033508749*^9}, {
  3.8718604130613003`*^9, 3.871860448596922*^9}, {3.872012527675662*^9, 
  3.87201260502358*^9}, {3.872012654926362*^9, 3.872012700541935*^9}, {
  3.8720128546763487`*^9, 3.8720128794520197`*^9}, {3.876688174858933*^9, 
  3.876688177582922*^9}, {3.876689329129746*^9, 3.876689336580097*^9}, {
  3.876689517554439*^9, 3.876689526075328*^9}, {3.876690170533423*^9, 
  3.876690171489439*^9}, {3.8775569273050947`*^9, 3.877556929051282*^9}, {
  3.877557729289589*^9, 3.877557732088353*^9}, {3.888692007263344*^9, 
  3.8886920073094263`*^9}, {3.9220504921055*^9, 3.922050508757084*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"b802b705-7b4e-437a-8530-4b278d49199b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vertexIsogonalStrain", "[", 
   RowBox[{"v_Integer", ",", "t_Integer", ",", 
    RowBox[{"scaleFactor_", "?", "NumberQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"triplet", "=", 
       RowBox[{"vertexCellsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", "v"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      "coords", ",", "\[IndentingNewLine]", "tCoords", ",", "A", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"areaThresh", "=", "0.15"}], ",", 
      RowBox[{"lengthThresh", "=", "0.5"}]}], "\[IndentingNewLine]", "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "triplet", "]"}], "!=", "3"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<DegenerateVertex\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "t"}], "}"}]}], "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"coords", "=", 
      RowBox[{"getTripletCoords", "[", 
       RowBox[{"triplet", ",", "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MissingQ", "[", "coords", "]"}], ",", 
       RowBox[{"Return", "[", "coords", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Min", "[", 
         RowBox[{"Norm", "/@", 
          RowBox[{"coords", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "<", "lengthThresh"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<ShortEdge\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "t"}], "}"}]}], "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tCoords", "=", 
      RowBox[{"tensionTriangle", "[", 
       RowBox[{"Normalize", "/@", 
        RowBox[{"coords", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MissingQ", "[", "tCoords", "]"}], ",", 
       RowBox[{"Return", "[", "tCoords", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"A", "=", 
      RowBox[{"Abs", "[", 
       RowBox[{"triArea", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"tCoords", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "-", 
          RowBox[{"tCoords", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"tCoords", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "-", 
          RowBox[{"tCoords", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Very", " ", "small", " ", "areas", " ", "indicate", " ", "degenerate", 
       " ", "triangles", " ", "and", " ", "will", " ", "be", " ", "discarded",
        " ", 
       RowBox[{"(", 
        RowBox[{
        "the", " ", "tensions", " ", "are", " ", "initially", " ", 
         "normalized", " ", "to", " ", "average", " ", "to", " ", "1"}], 
        ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"A", "<", "areaThresh"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<SmallArea\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "t"}], "}"}]}], "]"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tCoords", "=", 
      RowBox[{"tCoords", "/", 
       SqrtBox["A"]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fitDeformationMatrix2D", "[", 
       RowBox[{
        RowBox[{"scaleFactor", " ", "tCoords"}], ",", 
        RowBox[{"coords", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<Symmetric\>\""}], "]"}], 
      "[", 
      RowBox[{"[", "3", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.872597950571739*^9, 3.872597965374897*^9}, {
   3.87259800378524*^9, 3.8725980365589314`*^9}, {3.872598097627249*^9, 
   3.872598168175359*^9}, 3.872598230673276*^9, {3.872599438734723*^9, 
   3.872599509633671*^9}, {3.872599569276556*^9, 3.8725995864363947`*^9}, {
   3.8725999198037157`*^9, 3.8725999211762047`*^9}, {3.8726023143274403`*^9, 
   3.872602397099744*^9}, 3.872603315762875*^9, {3.872608182954851*^9, 
   3.872608183176662*^9}, {3.872608217670188*^9, 3.872608265788904*^9}, {
   3.872608309885523*^9, 3.872608377274046*^9}, {3.872608430930414*^9, 
   3.8726084610814047`*^9}, {3.872609112275004*^9, 3.872609112304291*^9}, {
   3.872609149498905*^9, 3.872609173723421*^9}, {3.87261951700336*^9, 
   3.87261953578036*^9}, 3.872620992515648*^9, {3.872807768223414*^9, 
   3.87280777039165*^9}, {3.877564486639421*^9, 3.877564486990409*^9}, {
   3.87756676851116*^9, 3.8775667886785307`*^9}, {3.8775668323449097`*^9, 
   3.87756683246345*^9}, 3.878434977779174*^9, {3.888690912334293*^9, 
   3.8886909392257433`*^9}, {3.8886909921380672`*^9, 3.888691031862295*^9}, {
   3.888692091073538*^9, 3.888692091129644*^9}, 3.888692543616252*^9, 
   3.8886926923377333`*^9, 3.889735890221243*^9, {3.9220504046154757`*^9, 
   3.922050405305481*^9}, {3.922052204151177*^9, 3.9220522042606277`*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"17349eb6-7e80-4d6d-8be7-9817f8bfb07b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Projection and rendering", "Subsubsection",
 CellChangeTimes->{{3.8581050680881767`*^9, 
  3.858105070704096*^9}},ExpressionUUID->"9bc7cc82-fa5e-4c16-802e-\
429dabfc52c3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"wrappedAngleQ", "[", "angles_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Abs", "[", 
      RowBox[{"angles", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], ">", 
     RowBox[{"\[Pi]", "/", "2"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", "=", 
        RowBox[{"Sign", "[", 
         RowBox[{"angles", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"Not", "[", 
       RowBox[{"And", "@@", 
        RowBox[{"Thread", "[", 
         RowBox[{"s", "\[Equal]", 
          RowBox[{"Sign", "[", 
           RowBox[{"angles", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;", 
              RowBox[{"-", "1"}]}], "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}], 
     "]"}], ",", "\[IndentingNewLine]", "False"}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.857398769897069*^9, 3.8573988288383703`*^9}, {
  3.857398861038561*^9, 3.8573990108448353`*^9}, {3.857399099501691*^9, 
  3.857399131277543*^9}, {3.857399411497348*^9, 3.8573994126879253`*^9}, {
  3.860181901446095*^9, 3.860181958453952*^9}, {3.8601820006526117`*^9, 
  3.860182004028151*^9}, {3.860182285756365*^9, 3.860182287433462*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"14c8d94d-a45c-4a05-b88b-d3e79548ca3c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "toCylinder", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"Offset", "->", 
      RowBox[{"-", "\[Pi]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"toCylinder", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "___"}], "]"}], ":=", 
    RowBox[{"{", "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"toCylinder", "[", 
     RowBox[{
      RowBox[{"p", ":", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"_", "?", "NumberQ"}], ")"}], ".."}], "}"}]}], ",", "axis_",
       ",", "r_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"r", " ", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ArcTan", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"axis", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "-", 
             RowBox[{"axis", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}], "+", 
          RowBox[{"OptionValue", "[", "Offset", "]"}]}], ",", 
         RowBox[{"2", "\[Pi]"}]}], "]"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"toCylinder", "[", 
     RowBox[{
      RowBox[{"p", ":", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"_", ",", "_", ",", "_"}], "}"}], ".."}], "}"}]}], ",", 
      "axis_", ",", "r_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"coords", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
             RowBox[{"ArcTan", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "-", 
                RowBox[{"axis", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "-", 
                RowBox[{"axis", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}]}], "}"}], "&"}], "/@",
           "p"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"offset", "=", 
         RowBox[{"OptionValue", "[", "Offset", "]"}]}]}], 
       "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"angles", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"wrappedAngleQ", "[", 
             RowBox[{"coords", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"#", "<", "0"}], ",", 
                RowBox[{"#", "+", 
                 RowBox[{"2", "\[Pi]"}], "+", "offset"}], ",", 
                RowBox[{"#", "+", "offset"}]}], "]"}], "&"}], "/@", 
             RowBox[{"coords", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Mod", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"coords", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "+", "offset"}], 
              ",", 
              RowBox[{"2", "\[Pi]"}]}], "]"}]}], "\[IndentingNewLine]", 
           "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"coords", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"r", " ", "angles"}]}], "}"}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"toCylinder", "[", 
    RowBox[{"p_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"toCylinder", "[", 
    RowBox[{"p", ",", "$axisOffset", ",", "$radius", ",", "opts"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8573995886682663`*^9, 3.857399589836495*^9}, {
   3.857399635625*^9, 3.8573996966825542`*^9}, {3.85739972713183*^9, 
   3.857399817114497*^9}, {3.857399886130147*^9, 3.857399896761518*^9}, {
   3.8579493349988813`*^9, 3.857949357131803*^9}, {3.858105210960506*^9, 
   3.8581052578292913`*^9}, {3.8581052972394648`*^9, 
   3.8581053062227573`*^9}, {3.8581751448692417`*^9, 3.858175443727974*^9}, {
   3.8581754822099113`*^9, 3.858175501050396*^9}, {3.859501873505599*^9, 
   3.8595018745525923`*^9}, {3.85950191558808*^9, 3.8595019297911367`*^9}, {
   3.859501994263681*^9, 3.859501995780335*^9}, {3.859502026719975*^9, 
   3.8595021419895782`*^9}, {3.859502181568359*^9, 3.85950219456332*^9}, {
   3.859590677938442*^9, 3.859590682654316*^9}, {3.859839834178174*^9, 
   3.859840025232479*^9}, {3.859840080925795*^9, 3.859840116288411*^9}, {
   3.859840441253518*^9, 3.859840445269311*^9}, {3.859840548780677*^9, 
   3.8598406234574137`*^9}, {3.85984077051764*^9, 3.859840819025867*^9}, {
   3.859840894561133*^9, 3.859840895712762*^9}, {3.859841042315833*^9, 
   3.8598410794395247`*^9}, {3.860180706455146*^9, 3.86018072101161*^9}, {
   3.8601807939655933`*^9, 3.860180821371256*^9}, {3.8601813035031548`*^9, 
   3.860181388486136*^9}, {3.8601816821633997`*^9, 3.860181770029923*^9}, {
   3.860181969887426*^9, 3.860182046662712*^9}, {3.860182087301807*^9, 
   3.8601820874213142`*^9}, {3.860182272277131*^9, 3.8601822746165123`*^9}, {
   3.860182331761532*^9, 3.8601823422949247`*^9}, {3.860182386728446*^9, 
   3.860182499264493*^9}, {3.860182550150606*^9, 3.860182550791069*^9}, {
   3.860182581793933*^9, 3.8601825838392153`*^9}, 3.86018277415239*^9, {
   3.860182904574854*^9, 3.86018298830606*^9}, {3.860183093061098*^9, 
   3.860183109973894*^9}, 3.860183214942572*^9, {3.860183501928186*^9, 
   3.860183503068741*^9}, {3.8601933473758707`*^9, 3.860193354311228*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"09b58b65-4dbe-40ce-91a5-958757e052c5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "renderCell2D", "]"}], "=", 
    RowBox[{"Options", "[", "toCylinder", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"renderCell2D", "[", 
     RowBox[{"i_", ",", "t_", ",", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"MissingQ", "[", "#", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Polygon", "[", 
         RowBox[{"toCylinder", "[", 
          RowBox[{
           RowBox[{"vertexCoordsTS", "[", 
            RowBox[{"[", 
             RowBox[{"t", ",", "#"}], "]"}], "]"}], ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"List", "[", "opts", "]"}], ",", 
              RowBox[{"Options", "[", "toCylinder", "]"}]}], "]"}]}]}], "]"}],
          "]"}]}], "\[IndentingNewLine]", "]"}], "&"}], "@", 
     RowBox[{
      RowBox[{"cellVerticesTS", "[", 
       RowBox[{"[", "t", "]"}], "]"}], "[", "i", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"renderCell2D", "[", 
    RowBox[{"i_", ",", "t_", ",", "\"\<Tooltip\>\"", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MissingQ", "[", "#", "]"}]}], ",", 
       RowBox[{"Tooltip", "[", 
        RowBox[{
         RowBox[{"Polygon", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"toCylinder", "[", 
              RowBox[{"#", ",", 
               RowBox[{"Sequence", "@@", 
                RowBox[{"FilterRules", "[", 
                 RowBox[{
                  RowBox[{"List", "[", "opts", "]"}], ",", 
                  RowBox[{"Options", "[", "toCylinder", "]"}]}], "]"}]}]}], 
              "]"}], ")"}], "&"}], "@", 
           RowBox[{"vertexCoordsTS", "[", 
            RowBox[{"[", 
             RowBox[{"t", ",", "#"}], "]"}], "]"}]}], "]"}], ",", "i"}], 
        "]"}]}], "\[IndentingNewLine]", "]"}], "&"}], "@", 
    RowBox[{
     RowBox[{"cellVerticesTS", "[", 
      RowBox[{"[", "t", "]"}], "]"}], "[", "i", "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.858112413902938*^9, 3.858112451207094*^9}, {
   3.858112683723702*^9, 3.85811268881118*^9}, {3.858175599902298*^9, 
   3.858175617772058*^9}, {3.859502200951007*^9, 3.859502212678356*^9}, {
   3.8601930808778057`*^9, 3.860193136379106*^9}, {3.860193237154079*^9, 
   3.860193345905219*^9}, 3.922133446644796*^9},
 CellLabel->"In[44]:=",ExpressionUUID->"068ec2d8-0261-42e4-9974-544fcbecb3f0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"periodicBoundaryQ", "[", "p_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"4", "<", 
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "-", 
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}]}], "&"}], "@", 
   RowBox[{"MinMax", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ArcTan", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;", "3"}], "]"}], "]"}], "-", 
         RowBox[{"$axisOffset", "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], ")"}]}], "&"}], "/@", 
     "p"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.889826758554532*^9, 3.889826762465432*^9}, {
  3.889826793398448*^9, 3.8898268501679163`*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"5882e444-d784-4dda-96a9-572ef0d7e613"],

Cell[BoxData[
 RowBox[{
  RowBox[{"periodicBoundaryCells", "[", "t_Integer", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"coords", "=", 
      RowBox[{"vertexCoordsTS", "[", 
       RowBox[{"[", "t", "]"}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Keys", "[", 
     RowBox[{"Select", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cellVerticesTS", "[", 
        RowBox[{"[", "t", "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"periodicBoundaryQ", "[", 
         RowBox[{"coords", "[", 
          RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}]}], 
      "\[IndentingNewLine]", "]"}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.877371279071125*^9, 3.877371450934135*^9}, {
  3.8773722597307463`*^9, 3.877372261195632*^9}, {3.889826879816534*^9, 
  3.88982688236812*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"b930b1dd-e52a-4504-b2ec-c3b979c77979"],

Cell[BoxData[
 RowBox[{
  RowBox[{"periodicBoundaryCells", "[", 
   RowBox[{"t_Integer", ",", 
    RowBox[{"cells", ":", 
     RowBox[{"{", 
      RowBox[{"_Integer", ".."}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"coords", "=", 
      RowBox[{"vertexCoordsTS", "[", 
       RowBox[{"[", "t", "]"}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Keys", "[", 
     RowBox[{"Select", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"KeyTake", "[", 
        RowBox[{
         RowBox[{"cellVerticesTS", "[", 
          RowBox[{"[", "t", "]"}], "]"}], ",", "cells"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"periodicBoundaryQ", "[", 
         RowBox[{"coords", "[", 
          RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}]}], 
      "\[IndentingNewLine]", "]"}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.877372265068863*^9, 3.877372293183221*^9}, {
   3.877372326591037*^9, 3.877372328963888*^9}, {3.877372441777906*^9, 
   3.877372445448914*^9}, {3.877372528086091*^9, 3.8773725301209593`*^9}, {
   3.877372571617936*^9, 3.8773725794746313`*^9}, 3.889826890522027*^9},
 CellLabel->"In[49]:=",ExpressionUUID->"3f42844f-50dc-4681-aa6f-35aa32a79fb8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"renderCellGroup2D", "[", 
   RowBox[{
    RowBox[{"cells", ":", 
     RowBox[{"{", 
      RowBox[{"_Integer", ".."}], "}"}]}], ",", "t_Integer"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"existingCells", "=", 
      RowBox[{"Intersection", "[", 
       RowBox[{
        RowBox[{"Keys", "[", 
         RowBox[{"cellCentroidsTS", "[", 
          RowBox[{"[", "t", "]"}], "]"}], "]"}], ",", "cells"}], "]"}]}], 
     "\[IndentingNewLine]", "}"}], ",", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"renderCell2D", "[", 
         RowBox[{"#", ",", "t"}], "]"}], "&"}], "/@", "existingCells"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"renderCell2D", "[", 
         RowBox[{"#", ",", "t", ",", 
          RowBox[{"Offset", "->", "\[Pi]"}]}], "]"}], "&"}], "/@", 
       RowBox[{"periodicBoundaryCells", "[", 
        RowBox[{"t", ",", "existingCells"}], "]"}]}]}], "\[IndentingNewLine]",
      "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.877381146994022*^9, 3.877381309045108*^9}, {
  3.8777206090724897`*^9, 3.877720609925783*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"8613a32e-dffc-4d4a-ac29-57008b929414"],

Cell[BoxData[
 RowBox[{
  RowBox[{"renderCellGroup2D", "[", 
   RowBox[{"cellAssoc_Association", ",", "t_Integer"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"existingCells", "=", 
      RowBox[{"Intersection", "[", 
       RowBox[{
        RowBox[{"Keys", "[", 
         RowBox[{"cellCentroidsTS", "[", 
          RowBox[{"[", "t", "]"}], "]"}], "]"}], ",", 
        RowBox[{"Keys", "[", "cellAssoc", "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "}"}], ",", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"KeyValueMap", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", "#2", "]"}], "===", "List"}], ",", 
             RowBox[{"Sequence", "@@", "#2"}], ",", "#2"}], "]"}], ",", 
           RowBox[{"renderCell2D", "[", 
            RowBox[{"#1", ",", "t"}], "]"}]}], "}"}], "&"}], ",", 
        RowBox[{"KeyTake", "[", 
         RowBox[{"cellAssoc", ",", "existingCells"}], "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"KeyValueMap", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", "#2", "]"}], "===", "List"}], ",", 
             RowBox[{"Sequence", "@@", "#2"}], ",", "#2"}], "]"}], ",", 
           RowBox[{"renderCell2D", "[", 
            RowBox[{"#1", ",", "t", ",", 
             RowBox[{"Offset", "->", "\[Pi]"}]}], "]"}]}], "}"}], "&"}], ",", 
        
        RowBox[{"KeyTake", "[", 
         RowBox[{"cellAssoc", ",", 
          RowBox[{"periodicBoundaryCells", "[", 
           RowBox[{"t", ",", "existingCells"}], "]"}]}], "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.877720636979828*^9, 3.877720656676881*^9}, {
   3.877720709469235*^9, 3.877720865537457*^9}, {3.877720923842648*^9, 
   3.877720940147438*^9}, 3.87772101448522*^9},
 CellLabel->"In[51]:=",ExpressionUUID->"cb4fb892-35ab-4cd0-b0bb-b830662da442"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Local tangent space", "Subsubsection",
 CellChangeTimes->{{3.859588715678734*^9, 
  3.859588720918399*^9}},ExpressionUUID->"c52052b9-cc29-4cc3-a0a0-\
d4eca7b4afa6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findTangentSpace", "[", "points_", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"com", "=", 
      RowBox[{"Mean", "[", "points", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"com", ",", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{
         RowBox[{"SingularValueDecomposition", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", "-", "com"}], ")"}], "&"}], "/@", "points"}], "]"}],
          "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], "}"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.858266676281047*^9, 3.858266682671549*^9}, {
   3.858266739287429*^9, 3.8582667399903917`*^9}, 3.858266795697237*^9, {
   3.858266897654213*^9, 3.8582669104853573`*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"4b9eebb8-487a-4ba0-a841-1fc3d32914a1"],

Cell["\<\
Order the basis vectors such that the handedness of the local basis is \
consistent relative to some reference point (i.e. the normal points away from \
the refence).\
\>", "Text",
 CellChangeTimes->{{3.85923448349965*^9, 
  3.859234570278064*^9}},ExpressionUUID->"b23c0ec5-8952-4165-8fca-\
7928848a5cb7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findTangentSpace", "[", 
   RowBox[{"points_", ",", "ref_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ts", "=", 
      RowBox[{"findTangentSpace", "[", "points", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Cross", "@@", 
          RowBox[{"ts", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}], ".", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ts", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "-", "ref"}], ")"}]}], "<", "0"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ts", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"Reverse", "[", 
         RowBox[{"ts", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], ",", "ts"}], 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.859234341746749*^9, 3.85923447318843*^9}, {
  3.859234576057914*^9, 3.859234578671371*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"d5d136c5-4b62-4240-802e-7032a03ca2fe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"project", "[", 
    RowBox[{
     RowBox[{"point", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"_", "?", "NumberQ"}], ",", 
        RowBox[{"_", "?", "NumberQ"}], ",", 
        RowBox[{"_", "?", "NumberQ"}]}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"x0_", ",", 
       RowBox[{"{", 
        RowBox[{"v1_", ",", "v2_"}], "}"}]}], "}"}]}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v1", ".", 
      RowBox[{"(", 
       RowBox[{"point", "-", "x0"}], ")"}]}], ",", 
     RowBox[{"v2", ".", 
      RowBox[{"(", 
       RowBox[{"point", "-", "x0"}], ")"}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"project", "[", 
   RowBox[{
    RowBox[{"points", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_", ",", "_", ",", "_"}], "}"}], ".."}], "}"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"x0_", ",", 
      RowBox[{"{", 
       RowBox[{"v1_", ",", "v2_"}], "}"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"v1", ".", 
       RowBox[{"(", 
        RowBox[{"#", "-", "x0"}], ")"}]}], ",", 
      RowBox[{"v2", ".", 
       RowBox[{"(", 
        RowBox[{"#", "-", "x0"}], ")"}]}]}], "}"}], "&"}], "/@", 
   "points"}]}]}], "Input",
 CellChangeTimes->{{3.858266610890901*^9, 3.858266635152463*^9}, {
  3.858266670088064*^9, 3.85826671149619*^9}, {3.8582667547767344`*^9, 
  3.858266828215543*^9}, {3.858266883222913*^9, 3.858266927493486*^9}, {
  3.85913317710907*^9, 3.859133263027916*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"a13db603-af99-4b3e-94ad-29d4436fdaf6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"azimuthalUnitVector", "[", "p_", "]"}], ":=", 
  RowBox[{"Normalize", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"-", 
        RowBox[{"#", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "@", 
    RowBox[{"(", 
     RowBox[{"p", "-", "$axisOffset"}], ")"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.864499203951579*^9, 3.8644992373002157`*^9}, {
  3.864509247460167*^9, 3.864509249155477*^9}, {3.864586462451219*^9, 
  3.864586463018581*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"de4adcf3-5b8c-4492-812c-edfeae6ad6f9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"findLocalBasis", "::", "usage"}], "=", 
   "\"\<Calculates local surface normal from given points and returns basis \
vectors: axial, azimuthal, normal\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"findLocalBasis", "[", "points_", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"aVec", "=", 
       RowBox[{"azimuthalUnitVector", "[", 
        RowBox[{"Mean", "[", "points", "]"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"tangentVecs", "=", 
       RowBox[{
        RowBox[{"findTangentSpace", "[", 
         RowBox[{"points", ",", "$axisOffset"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}]}], "\[IndentingNewLine]", "}"}], ",",
     "\[IndentingNewLine]", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Cross", "[", 
       RowBox[{
        RowBox[{"Cross", "@@", "tangentVecs"}], ",", "aVec"}], "]"}], ",", 
      "\[IndentingNewLine]", "aVec", ",", "\[IndentingNewLine]", 
      RowBox[{"Cross", "@@", "tangentVecs"}]}], "\[IndentingNewLine]", 
     "}"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.864509158474218*^9, 3.864509192092897*^9}, {
   3.8645092523718157`*^9, 3.8645093395951767`*^9}, {3.86451052208457*^9, 
   3.864510523116873*^9}, {3.8645864660909243`*^9, 3.864586466562807*^9}, {
   3.864586587533362*^9, 3.864586591384704*^9}, {3.867015580994529*^9, 
   3.867015634050658*^9}, {3.878430571509124*^9, 3.87843057397003*^9}, 
   3.878430803231473*^9, 3.8784310742306223`*^9, 3.878432367953608*^9},
 CellLabel->"In[57]:=",ExpressionUUID->"0b959ec6-330f-46a3-b1c9-3d9e9dae9b85"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Geometry", "Subsubsection",
 CellChangeTimes->{{3.859588747653562*^9, 
  3.859588748621635*^9}},ExpressionUUID->"64d991fa-a4a7-44a9-92ee-\
44f8fabff933"],

Cell[BoxData[
 RowBox[{
  RowBox[{"threePointAngle", "[", 
   RowBox[{"{", 
    RowBox[{"p1_", ",", "p2_", ",", "p3_"}], "}"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"#", ">", "\[Pi]"}], ",", 
      RowBox[{
       RowBox[{"2", "\[Pi]"}], "-", "#"}], ",", "#"}], "]"}], "&"}], "@", 
   RowBox[{"Mod", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"ArcTan", "@@", 
        RowBox[{"(", 
         RowBox[{"p1", "-", "p2"}], ")"}]}], "-", 
       RowBox[{"ArcTan", "@@", 
        RowBox[{"(", 
         RowBox[{"p3", "-", "p2"}], ")"}]}]}], ")"}], ",", 
     RowBox[{"2", "\[Pi]"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.8582702317804737`*^9, 3.8582703432978373`*^9}, {
  3.858270538830409*^9, 3.858270550611846*^9}, {3.858270596262669*^9, 
  3.858270600911017*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"1ce72407-6fe0-4937-a313-7e9e542a8cb6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Cell area", "Subsubsection",
 CellChangeTimes->{{3.858104934289425*^9, 
  3.858104940102084*^9}},ExpressionUUID->"c134c998-d95f-4ff6-ba1e-\
789f7d13ab88"],

Cell[BoxData[
 RowBox[{
  RowBox[{"triangleArea", "[", 
   RowBox[{"{", 
    RowBox[{"p1_", ",", "p2_", ",", "p3_"}], "}"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Norm", "[", 
    RowBox[{"Cross", "[", 
     RowBox[{
      RowBox[{"p1", "-", "p2"}], ",", 
      RowBox[{"p3", "-", "p1"}]}], "]"}], "]"}], "/", "2"}]}]], "Input",
 CellChangeTimes->{{3.857656555555581*^9, 3.857656586249259*^9}, {
  3.857656684992096*^9, 3.857656691984317*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"ef20adaf-e4a1-4e56-b850-4f67694d483c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"polygonArea", "[", 
   RowBox[{"v_", ":", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"_", ",", "_", ",", "_"}], "}"}], ".."}], "}"}]}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "v", "]"}], "<", "3"}], ",", "0.", ",", 
    RowBox[{"Total", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"triangleArea", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Rest", "[", "v", "]"}], ",", "2", ",", "1"}], "]"}]}], 
     "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8595806468180513`*^9, 3.8595806772197723`*^9}, {
  3.8595807216815357`*^9, 3.8595807289914923`*^9}, {3.8603590941813107`*^9, 
  3.860359105256651*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"474e52a1-bd43-4783-a381-0388994532a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cellArea", "[", 
   RowBox[{"cId_", ",", "t_", ",", 
    RowBox[{"fallback_", ":", "0"}]}], "]"}], ":=", 
  RowBox[{"Catch", "[", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v", "=", 
       RowBox[{"vertexCoordsTS", "[", 
        RowBox[{"[", 
         RowBox[{"t", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"MatchQ", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"{", 
                  RowBox[{"_Integer", ".."}], "}"}]}], "]"}]}], ",", 
              RowBox[{"Throw", "[", "fallback", "]"}], ",", "#"}], "]"}], 
            "&"}], "@", 
           RowBox[{
            RowBox[{"cellVerticesTS", "[", 
             RowBox[{"[", "t", "]"}], "]"}], "[", "cId", "]"}]}]}], "]"}], 
        "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"polygonArea", "[", "v", "]"}]}], "\[IndentingNewLine]", "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.857656726081369*^9, 3.8576567883102818`*^9}, {
   3.857657042379631*^9, 3.85765708102605*^9}, {3.857657842846719*^9, 
   3.857657878006091*^9}, 3.859571700687511*^9, 3.859580720833975*^9, {
   3.859580781039112*^9, 3.8595807839113626`*^9}, {3.860358946986507*^9, 
   3.860358966010962*^9}, {3.922133512552874*^9, 3.9221335524528933`*^9}},
 CellLabel->
  "In[321]:=",ExpressionUUID->"3152f893-9fb2-47d3-8cf5-ec38955e268c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Graph analysis", "Subsubsection",
 CellChangeTimes->{{3.858105170735244*^9, 
  3.8581051817984324`*^9}},ExpressionUUID->"bb91eff0-d76c-4096-8798-\
d88d9c636b63"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getNeighborhood", "[", 
    RowBox[{"c_", ",", "t_", ",", "1"}], "]"}], ":=", 
   RowBox[{"Prepend", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"cellNeighborsTS", "[", 
       RowBox[{"[", "t", "]"}], "]"}], "[", "c", "]"}], ",", "c"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"getNeighborhood", "[", 
    RowBox[{"c_", ",", "t_", ",", "r_"}], "]"}], ":=", 
   RowBox[{"Union", "[", 
    RowBox[{"Catenate", "[", 
     RowBox[{"getNeighborhoods", "[", 
      RowBox[{"c", ",", "t", ",", "r"}], "]"}], "]"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8573466010665007`*^9, 3.857346677586606*^9}, {
  3.857346760874648*^9, 3.857346761440415*^9}, {3.8573468086341057`*^9, 
  3.8573469282967567`*^9}, {3.857346965261451*^9, 3.857346967689062*^9}, {
  3.857347009272346*^9, 3.857347037678504*^9}, {3.857405353237348*^9, 
  3.857405407114756*^9}, {3.857405955127931*^9, 3.8574059551286097`*^9}, {
  3.868368611701394*^9, 3.868368645595873*^9}, {3.889281567240559*^9, 
  3.889281579727353*^9}, {3.8892816231987057`*^9, 3.889281642336755*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"c384a172-5ccd-40d2-bd68-4ace20663f3f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getNeighborhood", "[", 
    RowBox[{
     RowBox[{"cells", ":", 
      RowBox[{"{", 
       RowBox[{"_Integer", ".."}], "}"}]}], ",", "t_", ",", "1"}], "]"}], ":=", 
   RowBox[{"Union", "[", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{"cells", ",", 
       RowBox[{
        RowBox[{"cellNeighborsTS", "[", 
         RowBox[{"[", "t", "]"}], "]"}], "/@", "cells"}]}], "}"}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getNeighborhood", "[", 
   RowBox[{
    RowBox[{"cells", ":", 
     RowBox[{"{", 
      RowBox[{"_Integer", ".."}], "}"}]}], ",", "t_", ",", "r_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"neighbors", "=", 
      RowBox[{"cellNeighborsTS", "[", 
       RowBox[{"[", "t", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Union", "[", 
     RowBox[{"Nest", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Catenate", "[", 
         RowBox[{"neighbors", "/@", "#"}], "]"}], "&"}], ",", 
       RowBox[{"Union", "[", 
        RowBox[{"Catenate", "[", 
         RowBox[{"neighbors", "/@", "cells"}], "]"}], "]"}], ",", 
       RowBox[{"r", "-", "1"}]}], "]"}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.860189720179504*^9, 3.86018979541206*^9}, {
  3.860189843010747*^9, 3.860189856363673*^9}, {3.860189899114437*^9, 
  3.860189899254384*^9}, {3.860189946674551*^9, 3.860190025373034*^9}, {
  3.868368647876669*^9, 3.8683686521805067`*^9}},
 CellLabel->"In[65]:=",ExpressionUUID->"210a5e3c-f604-4fe6-9a03-c7029b786c24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getNeighborhoods", "[", 
   RowBox[{"c_", ",", "t_", ",", "r_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"neighbors", "=", 
       RowBox[{"cellNeighborsTS", "[", 
        RowBox[{"[", "t", "]"}], "]"}]}], ",", 
      RowBox[{"ring", "=", 
       RowBox[{"{", "c", "}"}]}], ",", 
      RowBox[{"inner", "=", 
       RowBox[{"{", "c", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", "ring", "}"}], ",", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"ring", "=", 
          RowBox[{"Complement", "[", 
           RowBox[{
            RowBox[{"Union", "[", 
             RowBox[{"Catenate", "[", 
              RowBox[{"neighbors", "/@", "ring"}], "]"}], "]"}], ",", 
            "inner"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"inner", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"inner", ",", "ring"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "ring"}], ",", "\[IndentingNewLine]", "r"}], 
       "\[IndentingNewLine]", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.868368474003447*^9, {3.868368532821859*^9, 3.868368775449212*^9}, {
   3.868368807379554*^9, 3.868368820006002*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"482a3b8d-04b5-48b7-b88f-3d60e2fcb582"],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeGraph", "[", 
   RowBox[{"cells_", ",", "neighborAssoc_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"existingCells", "=", 
      RowBox[{"Intersection", "[", 
       RowBox[{"cells", ",", 
        RowBox[{"Keys", "[", "neighborAssoc", "]"}]}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Graph", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "\[UndirectedEdge]", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "\[IndentingNewLine]", 
      RowBox[{"Union", "[", 
       RowBox[{"Sort", "/@", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Thread", "/@", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{"existingCells", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Intersection", "[", 
                 RowBox[{
                  RowBox[{"neighborAssoc", "[", "#", "]"}], ",", 
                  "existingCells"}], "]"}], "&"}], "/@", "existingCells"}]}], 
             "}"}], "]"}]}], ",", "1"}], "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.8581914391100388`*^9, 3.858191441369923*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"81fdbda0-2e40-4bda-9962-6259edfd823c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findCellPairs", "[", 
   RowBox[{"cells_", ",", "t_"}], "]"}], ":=", 
  RowBox[{"Union", "[", 
   RowBox[{"Sort", "/@", 
    RowBox[{"Catenate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"Intersection", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"cellNeighborsTS", "[", 
              RowBox[{"[", "t", "]"}], "]"}], "[", "#", "]"}], ",", "cells"}],
            "]"}]}], "}"}], "]"}], "&"}], "/@", "cells"}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8658838891895657`*^9, 3.8658839038253117`*^9}},
 CellLabel->"In[69]:=",ExpressionUUID->"003f4c00-d23c-4903-86a2-13ef9ef31034"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Vertex and Edge analysis and rendering", "Subsubsection",
 CellChangeTimes->{{3.860371489034787*^9, 
  3.860371497970261*^9}},ExpressionUUID->"bb413fe8-53f7-4072-8e5f-\
1eef23815cbd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sharedVertices", "[", 
   RowBox[{
    RowBox[{"cells", ":", 
     RowBox[{"{", 
      RowBox[{"_Integer", ".."}], "}"}]}], ",", "t_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"vertices", "=", 
      RowBox[{
       RowBox[{"cellVerticesTS", "[", 
        RowBox[{"[", "t", "]"}], "]"}], "/@", "cells"}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Count", "[", 
        RowBox[{"vertices", ",", "_Missing"}], "]"}], "!=", "0"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Intersection", "@@", "vertices"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8581843816008387`*^9, 3.858184448977337*^9}, {
   3.858184480959742*^9, 3.8581845030721493`*^9}, 3.85818453642905*^9, {
   3.858192302737628*^9, 3.858192309622403*^9}, {3.861143592537491*^9, 
   3.8611436023369303`*^9}, {3.8659587018207808`*^9, 3.865958766216501*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"40febb44-a707-450f-8891-d8634e5a6517"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sharedEdgeLength", "[", 
   RowBox[{
    RowBox[{"cells", ":", 
     RowBox[{"{", 
      RowBox[{"_Integer", ",", "_Integer"}], "}"}]}], ",", "t_Integer"}], 
   "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], "<", "2"}], ",", "0", ",", 
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "-", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}], "&"}], "@", 
   RowBox[{"vertexCoordsTS", "[", 
    RowBox[{"[", 
     RowBox[{"t", ",", 
      RowBox[{"sharedVertices", "[", 
       RowBox[{"cells", ",", "t"}], "]"}]}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.858184814588449*^9, 3.858184821148176*^9}, {
  3.8667316474096193`*^9, 3.866731648319738*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"fdfdf855-29e9-450b-a023-15b19b6a426a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"renderSharedEdge", "[", 
   RowBox[{"cells_", ",", "t_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Line", "[", 
   RowBox[{"toCylinder", "[", 
    RowBox[{"vertexCoordsTS", "[", 
     RowBox[{"[", 
      RowBox[{"t", ",", 
       RowBox[{"sharedVertices", "[", 
        RowBox[{"cells", ",", "t"}], "]"}]}], "]"}], "]"}], "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.857947868563829*^9, 3.857947908192461*^9}, {
   3.85794794821559*^9, 3.8579479822538013`*^9}, {3.857948102198057*^9, 
   3.857948103053074*^9}, 3.8579494115281363`*^9, {3.858183384799306*^9, 
   3.8581833848865833`*^9}, {3.859502320848279*^9, 3.859502321579574*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"d2b9d991-2338-4125-a364-b592e6f3a644"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Select cells sparsely (for visualization)", "Subsubsection",
 CellChangeTimes->{{3.889825228276231*^9, 
  3.889825237206109*^9}},ExpressionUUID->"c9912e61-fbfb-423c-8d40-\
adf9cd28677b"],

Cell[BoxData[
 RowBox[{"Clear", "[", "sampleCellsSparse", "]"}]], "Input",
 CellChangeTimes->{{3.88982563748983*^9, 3.8898256532597857`*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"37423008-7995-45b3-94db-25bf5fe1af1e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sampleCellsSparse", "[", 
   RowBox[{"t_Integer", ",", "n_Integer", ",", 
    RowBox[{"exclude_", ":", 
     RowBox[{"{", "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"activeCells", "=", 
       RowBox[{"{", 
        RowBox[{"RandomChoice", "[", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Keys", "[", 
            RowBox[{"cellCentroidsTS", "[", 
             RowBox[{"[", "t", "]"}], "]"}], "]"}], ",", "exclude"}], "]"}], 
         "]"}], "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"deadCells", "=", 
       RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"selectedCells", "=", 
       RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "visitCell"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"visitCell", "[", "c_", "]"}], ":=", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"neighborhoods", "=", 
          RowBox[{"getNeighborhoods", "[", 
           RowBox[{"c", ",", "t", ",", "n"}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"activeCells", "=", 
          RowBox[{"Complement", "[", 
           RowBox[{
            RowBox[{"Union", "[", 
             RowBox[{"activeCells", ",", 
              RowBox[{"Complement", "[", 
               RowBox[{
                RowBox[{"neighborhoods", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}], ",", "deadCells", ",", 
                "exclude"}], "]"}]}], "]"}], ",", 
            RowBox[{"Catenate", "[", 
             RowBox[{"neighborhoods", "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", 
                RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"deadCells", "=", 
          RowBox[{"Union", "[", 
           RowBox[{"deadCells", ",", 
            RowBox[{"Catenate", "[", 
             RowBox[{"neighborhoods", "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", 
                RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"selectedCells", ",", "c"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "activeCells", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"visitCell", "[", 
        RowBox[{"RandomChoice", "[", "activeCells", "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Graphics", "[", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{"Red", ",", "\[IndentingNewLine]", 
         RowBox[{"renderCellGroup2D", "[", 
          RowBox[{"deadCells", ",", "1"}], "]"}], ",", "\[IndentingNewLine]", 
         "Blue", ",", "\[IndentingNewLine]", 
         RowBox[{"renderCellGroup2D", "[", 
          RowBox[{"activeCells", ",", "1"}], "]"}], ",", 
         "\[IndentingNewLine]", "Green", ",", "\[IndentingNewLine]", 
         RowBox[{"renderCellGroup2D", "[", 
          RowBox[{"selectedCells", ",", "1"}], "]"}]}], "\[IndentingNewLine]",
         "}"}], "]"}], "*)"}], "\[IndentingNewLine]", "selectedCells"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.889824366625146*^9, 3.88982440054137*^9}, {
   3.8898244377993526`*^9, 3.889824645187893*^9}, {3.889824698208476*^9, 
   3.889825080513081*^9}, {3.889825119025666*^9, 3.88982512136934*^9}, {
   3.889825154750513*^9, 3.889825171926606*^9}, 3.889825418534892*^9, {
   3.889825452589625*^9, 3.889825506795795*^9}, {3.889825598918569*^9, 
   3.889825674706066*^9}},
 CellLabel->"In[74]:=",ExpressionUUID->"92bc054d-293f-46bc-9d11-a0223a8bccae"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Utils", "Subsection",
 CellChangeTimes->{{3.858105098751708*^9, 
  3.8581050995438347`*^9}},ExpressionUUID->"11e7d881-058a-4b1a-928d-\
aabaf01fba8c"],

Cell[CellGroupData[{

Cell["Abort on message", "Subsubsection",
 CellChangeTimes->{{3.858183651585046*^9, 
  3.858183655377811*^9}},ExpressionUUID->"2460b586-31cc-437f-8da1-\
a1140e8469e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$abortExceptions", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Power", "::", "_"}], ",", 
     RowBox[{"FindMinimum", "::", "fmgz"}], ",", 
     RowBox[{"NIntegrate", "::", "slwcon"}], ",", 
     RowBox[{"FindMinimum", "::", "sszero"}], ",", 
     StyleBox[
      RowBox[{"General", "::", "stop"}], "MessageName"]}], "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.853947655234886*^9, 3.853947669440154*^9}, {
  3.8539477830405273`*^9, 3.853947794470229*^9}, {3.872373270981366*^9, 
  3.872373372772615*^9}, {3.872602751727767*^9, 3.872602757055313*^9}, {
  3.873383769122829*^9, 3.873383769442588*^9}, {3.873401602658267*^9, 
  3.873401603476347*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"ab354758-72fe-44b8-add9-29a8c4e02ced"],

Cell[BoxData[
 RowBox[{
  RowBox[{"abortOnMessageOn", "[", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"messageHandler", "=", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Last", "[", "#", "]"}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"MatchQ", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"Alternatives", "@@", "$abortExceptions"}]}], "]"}]}], 
           ",", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Abort on message.\>\"", ",", "Red"}], "]"}], "]"}],
             ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "]"}], "&"}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"clearMessageHandlers", "[", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Internal`AddHandler", "[", 
      RowBox[{"\"\<Message\>\"", ",", "messageHandler"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.853947018827838*^9, 3.853947031713863*^9}, {
   3.853947106010516*^9, 3.853947126355104*^9}, {3.85394716885896*^9, 
   3.853947179958047*^9}, {3.853947385078273*^9, 3.853947387508774*^9}, {
   3.853947472124539*^9, 3.8539474832982264`*^9}, {3.853947518924644*^9, 
   3.853947552722258*^9}, {3.853947680962685*^9, 3.853947775015168*^9}, {
   3.853947838880652*^9, 3.853947849365904*^9}, {3.8539479108232193`*^9, 
   3.8539479145816317`*^9}, {3.864752514540388*^9, 3.864752537006035*^9}, 
   3.872373297117474*^9, {3.936027603688239*^9, 3.936027611805415*^9}},
 CellLabel->"In[45]:=",ExpressionUUID->"50db5fb0-722b-442f-8ad0-f7c513e8860e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"messageHandlers", "[", "]"}], ":=", 
  RowBox[{"\"\<Message\>\"", "/.", 
   RowBox[{"(", 
    RowBox[{"Internal`Handlers", "[", "\"\<Message\>\"", "]"}], 
    ")"}]}]}]], "Input",
 CellLabel->"In[77]:=",ExpressionUUID->"3858d655-9cd6-4074-83ac-806f55eb8d42"],

Cell[BoxData[
 RowBox[{
  RowBox[{"clearMessageHandlers", "[", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Internal`RemoveHandler", "[", 
     RowBox[{"\"\<Message\>\"", ",", "#"}], "]"}], "&"}], "/@", 
   RowBox[{"(", 
    RowBox[{"\"\<Message\>\"", "/.", 
     RowBox[{"(", 
      RowBox[{"Internal`Handlers", "[", "\"\<Message\>\"", "]"}], ")"}]}], 
    ")"}]}]}]], "Input",
 CellChangeTimes->{{3.853947218797056*^9, 3.8539472939898863`*^9}, {
  3.853947351930952*^9, 3.853947374292221*^9}},
 CellLabel->"In[78]:=",ExpressionUUID->"4cbab325-af12-4960-9511-b5f7d03a50c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"abortOnMessageOff", "[", "]"}], ":=", 
   RowBox[{"clearMessageHandlers", "[", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.853947934151458*^9, 3.8539479484603024`*^9}, {
  3.864752525904545*^9, 3.8647525401551313`*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"344d4ae1-4137-4a11-9f7d-f698be000380"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"clearMessageHandlers", "[", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"abortOnMessageOn", "[", "]"}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.853947805882264*^9, 3.8539478116700706`*^9}, 
   3.853947876118272*^9, 3.8644995635150137`*^9, {3.864752544737104*^9, 
   3.864752546183526*^9}},
 CellLabel->"In[80]:=",ExpressionUUID->"c1072c3a-0aab-4ae9-bd8e-fc1bc116946c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Cascading With", "Subsubsection",
 CellChangeTimes->{{3.8592307180970707`*^9, 
  3.8592307203298407`*^9}},ExpressionUUID->"d027212c-91e9-465f-a888-\
a355144b9312"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "CWith", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"CWith", ",", "HoldAll"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SyntaxInformation", "[", "CWith", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<ArgumentsPattern\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"_", ",", "_"}], "}"}]}], ",", 
     RowBox[{"\"\<LocalVariables\>\"", "->", 
      RowBox[{"{", 
       RowBox[{"\"\<Solve\>\"", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "Infinity"}], "}"}]}], "}"}]}]}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"CWith", "/:", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"assign", ":", 
      RowBox[{"SetDelayed", "|", "RuleDelayed"}]}], ")"}], "[", 
    RowBox[{"lhs_", ",", 
     RowBox[{"rhs", ":", 
      RowBox[{"HoldPattern", "[", 
       RowBox[{"CWith", "[", 
        RowBox[{
         RowBox[{"{", "__", "}"}], ",", "_"}], "]"}], "]"}]}]}], "]"}], ":=", 
   
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "With", "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Attributes", "[", "With", "]"}], "=", 
       RowBox[{"{", "HoldAll", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"assign", "[", 
       RowBox[{"lhs", ",", 
        RowBox[{"Evaluate", "[", "rhs", "]"}]}], "]"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CWith", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "expr_"}], "]"}], ":=", "expr"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CWith", "[", 
    RowBox[{
     RowBox[{"{", "head_", "}"}], ",", "expr_"}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "head", "}"}], ",", "expr"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CWith", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"head_", ",", "tail__"}], "}"}], ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "With", "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Attributes", "[", "With", "]"}], "=", 
       RowBox[{"{", "HoldAll", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "head", "}"}], ",", 
        RowBox[{"Evaluate", "[", 
         RowBox[{"CWith", "[", 
          RowBox[{
           RowBox[{"{", "tail", "}"}], ",", "expr"}], "]"}], "]"}]}], 
       "]"}]}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.859230721327983*^9, 3.859230744443563*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"56dc4437-04fe-4802-b030-208683be7dea"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Constrained Least Squares", "Subsubsection",
 CellChangeTimes->{{3.859325182907221*^9, 
  3.8593251878683662`*^9}},ExpressionUUID->"01319d67-4616-4d9c-96a2-\
f7c58bf72c14"],

Cell[BoxData[
 RowBox[{
  RowBox[{"constrainedLeastSquares", "[", "A_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"b", ",", "bVec", ",", "res"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bVec", "=", 
      RowBox[{"Array", "[", 
       RowBox[{"b", ",", 
        RowBox[{
         RowBox[{"Dimensions", "[", "A", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{"NMinimize", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"A", ".", "bVec"}], ")"}], "^", "2"}], "]"}], ",", 
          RowBox[{
           RowBox[{"Total", "[", "bVec", "]"}], "==", 
           RowBox[{"N", "@", 
            RowBox[{
             RowBox[{"Dimensions", "[", "A", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}]}], "}"}], ",", "bVec"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"bVec", "/.", 
        RowBox[{"res", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ",", 
       RowBox[{"res", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8593209565612497`*^9, 3.8593209841384172`*^9}, {
  3.859321026066111*^9, 3.859321052950693*^9}, {3.85932109221307*^9, 
  3.859321128164822*^9}, {3.859321164624082*^9, 3.859321316944674*^9}},
 CellLabel->"In[88]:=",ExpressionUUID->"14c22970-b02f-4014-805d-d278f6db895f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Other utils", "Subsubsection",
 CellChangeTimes->{{3.867348909536536*^9, 
  3.8673489106899014`*^9}},ExpressionUUID->"62479e14-52ba-4d92-87ca-\
93d198369095"],

Cell[BoxData[
 RowBox[{
  RowBox[{"inBoxQ", "[", 
   RowBox[{"p_", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x0_", ",", "x1_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"y0_", ",", "y1_"}], "}"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"x0", "<", 
    RowBox[{"p", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "<", "x1"}], "&&", 
   RowBox[{"y0", "<", 
    RowBox[{"p", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "<", "y1"}]}]}]], "Input",
 CellChangeTimes->{{3.9220509156842546`*^9, 3.922050917125942*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"92c3fdfe-8e37-4dd7-8d55-bd6cd75e70a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dirToTensor", "[", "n_", "]"}], ":=", 
  RowBox[{"2", 
   RowBox[{"Norm", "[", 
    RowBox[{"N", "[", "n", "]"}], "]"}], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#", "\[TensorProduct]", "#"}], "-", 
       RowBox[{
        RowBox[{"IdentityMatrix", "[", 
         RowBox[{"Length", "[", "n", "]"}], "]"}], "/", 
        RowBox[{"Length", "[", "n", "]"}]}]}], "&"}], "@", 
     RowBox[{"Normalize", "[", 
      RowBox[{"N", "[", "n", "]"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.868048192703373*^9, 3.868048245799591*^9}, {
   3.86804839656262*^9, 3.868048455058709*^9}, {3.868048492405468*^9, 
   3.868048514961895*^9}, {3.8680485509686193`*^9, 3.868048578830105*^9}, 
   3.868048875071282*^9, {3.8680489490107117`*^9, 3.8680489579544992`*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"b793a153-95ab-407e-8a99-851083aa5fb0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tensorToDir", "[", "Q_", "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"es", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"Eigensystem", "[", 
          RowBox[{"N", "[", "Q", "]"}], "]"}], "]"}], ",", "First"}], "]"}]}],
      "}"}], ",", 
    RowBox[{"Times", "@@", 
     RowBox[{"es", "[", 
      RowBox[{"[", 
       RowBox[{"-", "1"}], "]"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.868048772423072*^9, 3.868048844485235*^9}, {
  3.868048965938483*^9, 3.868048967097728*^9}},
 CellLabel->"In[90]:=",ExpressionUUID->"fa347930-e12a-4189-975a-323fdc1cf237"],

Cell[BoxData[
 RowBox[{
  RowBox[{"norm2", "=", 
   RowBox[{
    RowBox[{"#", ".", "#"}], "&"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.857335685061466*^9, 3.857335695628253*^9}, 
   3.857336540605249*^9},
 CellLabel->"In[91]:=",ExpressionUUID->"a99e9352-1172-438f-b264-8aa4bef3afb5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SowIf", "[", 
    RowBox[{"e_", ",", "test_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"test", "[", "e", "]"}], ",", 
     RowBox[{"Sow", "[", "e", "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.857345434730103*^9, 3.8573454766073*^9}},
 CellLabel->"In[92]:=",ExpressionUUID->"6d9e1683-6ee4-4340-bf03-1f447d58539e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"findContinuousIntervals", "[", 
   RowBox[{"list", ":", 
    RowBox[{"{", 
     RowBox[{"_Integer", ".."}], "}"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"breakPos", "=", 
      RowBox[{"First", "/@", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Differences", "[", "list", "]"}], ",", 
         RowBox[{"Except", "[", "1", "]"}], ",", 
         RowBox[{"{", "1", "}"}], ",", 
         RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Switch", "[", 
     RowBox[{
      RowBox[{"Length", "[", "breakPos", "]"}], ",", "\[IndentingNewLine]", 
      "0", ",", 
      RowBox[{"{", 
       RowBox[{"list", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], "}"}], ",", 
      "\[IndentingNewLine]", "1", ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"list", "[", 
         RowBox[{"[", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"breakPos", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], "]"}], ",", 
        RowBox[{"list", "[", 
         RowBox[{"[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"breakPos", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], ",", 
            RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}], ",", 
      "\[IndentingNewLine]", "_", ",", 
      RowBox[{"Join", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"list", "[", 
          RowBox[{"[", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"breakPos", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], "]"}], "}"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"list", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], "]"}], "&"}], "/@", 
         RowBox[{"Partition", "[", 
          RowBox[{"breakPos", ",", "2", ",", "1"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"list", "[", 
          RowBox[{"[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"breakPos", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}], "+", "1"}], ",", 
             RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], "}"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.857521714396357*^9, 3.85752189318053*^9}, {
  3.857521933383052*^9, 3.857521957641724*^9}, {3.857522003698031*^9, 
  3.857522079665835*^9}, {3.8575221618756523`*^9, 3.857522250848845*^9}, {
  3.857522285715819*^9, 3.857522323042046*^9}, {3.857522359324389*^9, 
  3.8575224895526667`*^9}, {3.857522538122333*^9, 3.8575225639386806`*^9}, {
  3.857526257100483*^9, 3.857526257299274*^9}, {3.857526299852518*^9, 
  3.857526341547472*^9}, {3.857526380972023*^9, 3.857526382891416*^9}, {
  3.8575664259638042`*^9, 3.857566443674675*^9}, {3.85757348383212*^9, 
  3.857573495902726*^9}, {3.85757372501191*^9, 3.857573793487135*^9}, {
  3.857573886867319*^9, 3.857573887866729*^9}},
 CellLabel->"In[93]:=",ExpressionUUID->"a0df2018-9700-4958-a0ac-c79a8d10609c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"lastPosition", "[", 
   RowBox[{"l_", ",", "p_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Length", "[", "l", "]"}], "+", "1", "-", 
   RowBox[{"First", "@", 
    RowBox[{"FirstPosition", "[", 
     RowBox[{
      RowBox[{"Reverse", "[", "l", "]"}], ",", "p", ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Length", "[", "l", "]"}], "+", "1"}], "}"}]}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.859503464629273*^9, 3.859503557748622*^9}, {
  3.859765311043365*^9, 3.85976531446603*^9}, {3.8597653467143087`*^9, 
  3.8597654191857843`*^9}},
 CellLabel->"In[94]:=",ExpressionUUID->"a1cde499-9f2f-4d95-b34a-8907aa1ed37f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"signChangePos", "[", "l_", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
    "Print", "[", 
     "\"\<WARNING the protected First[] only returns the first sign change. \
For all sign changes First/@ would make more sense.\>\"", "]"}], ";", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"#", "==", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}], "@", 
     RowBox[{"Position", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Sign", "[", "l", "]"}], ",", "2", ",", "1"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"-", "1"}], "|", "0"}], ",", 
       RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   ")"}]}]], "Input",
 CellChangeTimes->{{3.865167146341762*^9, 3.865167147856311*^9}, {
   3.865167183307808*^9, 3.8651672049793463`*^9}, 3.8651673094903307`*^9, {
   3.865167360584736*^9, 3.8651674458036327`*^9}},
 CellLabel->"In[95]:=",ExpressionUUID->"abeba6e9-e762-4370-aed3-e86457415a8c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"firstSignChangePos", "[", "l_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MissingQ", "[", "#", "]"}], ",", "#", ",", 
       RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}], "@", 
    RowBox[{"FirstPosition", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Sign", "[", "l", "]"}], ",", "2", ",", "1"}], "]"}]}], ",", 
      
      RowBox[{
       RowBox[{"-", "1"}], "|", "0"}], ",", 
      RowBox[{"{", "1", "}"}]}], "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.876686174331582*^9, 3.876686218257156*^9}},
 CellLabel->"In[96]:=",ExpressionUUID->"527fa79e-56c6-45d7-b13f-87c4cf0d0f31"],

Cell[BoxData[
 RowBox[{
  RowBox[{"signChangePositions", "[", "l_", "]"}], ":=", 
  RowBox[{"First", "/@", 
   RowBox[{"Position", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Sign", "[", "l", "]"}], ",", "2", ",", "1"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "1"}], "|", "0"}], ",", 
     RowBox[{"{", "1", "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.87676033841812*^9, 3.876760348566496*^9}, {
  3.876760380449872*^9, 3.876760392618503*^9}},
 CellLabel->"In[97]:=",ExpressionUUID->"fc132d75-b83a-4e86-a356-bc20ce0ef23a"],

Cell[BoxData[{
 RowBox[{"SetAttributes", "[", 
  RowBox[{"printTiming", ",", "HoldFirst"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"printTiming", "[", "expr_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], ";", 
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "&"}], "@", 
   RowBox[{"AbsoluteTiming", "[", "expr", "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.860019745290697*^9, 3.860019799964199*^9}, 
   3.8600198743823147`*^9},
 CellLabel->"In[98]:=",ExpressionUUID->"8ed2af03-b9e1-4457-8829-cb36d0843e4e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"keyValueSelect", "[", 
   RowBox[{"assoc_", ",", "crit_"}], "]"}], ":=", 
  RowBox[{"Association", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"#", "==", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{"First", "[", "#", "]"}]}], "]"}], "&"}], "@", 
    RowBox[{"Last", "@", 
     RowBox[{"Reap", "[", 
      RowBox[{"KeyValueMap", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"crit", "[", "##", "]"}], ",", 
            RowBox[{"Sow", "[", 
             RowBox[{"#1", "->", "#2"}], "]"}]}], "]"}], ";"}], "&"}], ",", 
        "assoc"}], "]"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.859509829839488*^9, 3.859509930098288*^9}},
 CellLabel->
  "In[100]:=",ExpressionUUID->"ff368217-3423-4d8b-8f6d-c44018ad1f63"],

Cell[BoxData[
 RowBox[{
  RowBox[{"averageTimeseries", "[", 
   RowBox[{"data", ":", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", "_"}], "}"}], ".."}], "}"}], ".."}], 
     "}"}]}], "]"}], ":=", 
  RowBox[{"SortBy", "[", 
   RowBox[{
    RowBox[{"KeyValueMap", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#1", ",", "#2"}], "}"}], "&"}], ",", 
      RowBox[{"Mean", "/@", 
       RowBox[{
        RowBox[{"GroupBy", "[", 
         RowBox[{
          RowBox[{"Catenate", "[", "data", "]"}], ",", "First"}], "]"}], "[", 
        
        RowBox[{"[", 
         RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}]}]}], "]"}], ",", 
    "First"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.860373161135109*^9, 3.860373188974834*^9}, {
  3.860373318011519*^9, 3.860373326819304*^9}, {3.860373360069345*^9, 
  3.8603733626667128`*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"74cd8e50-cb4e-4bae-a40b-f17123143b6d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"binByFirst", "[", 
   RowBox[{"data_", ",", "binSize_"}], "]"}], ":=", 
  RowBox[{"SortBy", "[", 
   RowBox[{
    RowBox[{"KeyValueMap", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#1", ",", "#2"}], "}"}], "&"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Last", "/@", "#"}], "&"}], "/@", 
       RowBox[{"GroupBy", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"Round", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "binSize"}], "]"}], "&"}]}],
         "]"}]}]}], "]"}], ",", "First"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.867347059629117*^9, 3.867347131731662*^9}, {
  3.8673471659929123`*^9, 3.867347166362125*^9}},
 CellLabel->
  "In[102]:=",ExpressionUUID->"27c83e8a-ec78-4de4-a554-c7e4853dd355"],

Cell[BoxData[
 RowBox[{
  RowBox[{"binByFirst", "[", "data_", "]"}], ":=", 
  RowBox[{"SortBy", "[", 
   RowBox[{
    RowBox[{"KeyValueMap", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#1", ",", "#2"}], "}"}], "&"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Last", "/@", "#"}], "&"}], "/@", 
       RowBox[{"GroupBy", "[", 
        RowBox[{"data", ",", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "&"}]}], "]"}]}]}], "]"}], ",", 
    "First"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8677073814199123`*^9, 3.867707398079657*^9}},
 CellLabel->
  "In[103]:=",ExpressionUUID->"5c3cb40b-7801-467d-a43c-246a76051173"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"enumerate", "[", "l_", "]"}], ":=", 
   RowBox[{"Association", "[", 
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "l", "]"}], "]"}], "->", "l"}], "]"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.922049199763135*^9, 3.922049231516719*^9}},
 CellLabel->
  "In[150]:=",ExpressionUUID->"0249d40f-1d5d-4d22-ac64-cfb1ec6b0885"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plotting", "Subsection",
 CellChangeTimes->{{3.8673488911367807`*^9, 
  3.867348895409835*^9}},ExpressionUUID->"c39456d1-bd33-4db2-b4aa-\
2b09ecd4a119"],

Cell[CellGroupData[{

Cell["Colorbar", "Subsubsection",
 CellChangeTimes->{{3.877721282394581*^9, 
  3.87772128507018*^9}},ExpressionUUID->"d3d3c586-de86-4463-8bc9-\
7c3448e2db1f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "renderColorbar", "]"}], " ", ":=", " ", 
   RowBox[{"Options", "[", "ArrayPlot", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"renderColorbar", "[", 
   RowBox[{"colorFunc_", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"ArrayPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Range", "[", 
      RowBox[{"0", ",", " ", "1", ",", " ", "0.01"}], "]"}], "}"}], ",", "\n",
     "\t", 
    RowBox[{"ColorFunction", " ", "->", " ", "colorFunc"}], ",", "\n", "\t", 
    "opts", ",", "\n", "\t", 
    RowBox[{"AspectRatio", " ", "->", " ", 
     RowBox[{"1", "/", "10"}]}], ",", " ", 
    RowBox[{"Frame", " ", "->", " ", "None"}], ",", " ", 
    RowBox[{"PlotRangePadding", " ", "->", " ", "None"}]}], "\n", 
   "]"}]}]}], "Input",
 CellLabel->
  "In[104]:=",ExpressionUUID->"2c7ee695-44e6-400f-9466-b4782e9f9243"]
}, Open  ]],

Cell[CellGroupData[{

Cell["scatterDensityPlot[]", "Subsubsection",
 CellChangeTimes->{{3.8652081140329027`*^9, 
  3.8652081249447727`*^9}},ExpressionUUID->"4644a33e-77f5-4760-b284-\
e1d5dd724d24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"numericQ", "[", "x_", "]"}], ":=", 
  RowBox[{"NumericQ", "[", 
   RowBox[{"N", "[", "x", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.87182903470006*^9, 3.8718290507686768`*^9}},
 CellLabel->
  "In[106]:=",ExpressionUUID->"3715e484-bc44-4aaf-8719-c223e0a79ab0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "scatterDensityPlot", "]"}], "=", 
   RowBox[{"Join", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Options", "[", "Graphics", "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ColorFunction", "->", "\"\<BlueGreenYellow\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<KernelSize\>\"", "->", "0.15"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<PointSize\>\"", "->", "0.013"}]}], "\[IndentingNewLine]", 
      "}"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"scatterDensityPlot", "[", 
    RowBox[{
     RowBox[{"points", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", "numericQ"}], ",", 
          RowBox[{"_", "?", "numericQ"}]}], "}"}], ".."}], "}"}]}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"normalizedPoints", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "/", 
           RowBox[{"StandardDeviation", "[", 
            RowBox[{"N", "[", "#", "]"}], "]"}]}], "&"}], "/@", 
         RowBox[{"Transpose", "[", "points", "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"PointSize", "[", 
          RowBox[{"OptionValue", "[", "\"\<PointSize\>\"", "]"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Point", "[", 
          RowBox[{"points", ",", 
           RowBox[{"VertexColors", "->", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Blend", "[", 
                  RowBox[{"\"\<BlueGreenYellow\>\"", ",", "#"}], "]"}], "&"}],
                 "/@", 
                RowBox[{"Rescale", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"MinMax", "[", "#", "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], "&"}], "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"PDF", "[", 
                  RowBox[{
                   RowBox[{"SmoothKernelDistribution", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"OptionValue", "[", "\"\<KernelSize\>\"", "]"}]}],
                     "]"}], ",", "#"}], "]"}], "&"}], "@", 
                "normalizedPoints"}], ")"}]}], ")"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"List", "[", "opts", "]"}], ",", 
          RowBox[{"Options", "[", "Graphics", "]"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", "]"}]}],
     "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.865206572281795*^9, 3.865206586350431*^9}, {
  3.865206651620469*^9, 3.865206824610845*^9}, {3.865206897800655*^9, 
  3.8652069213973303`*^9}, {3.8652070781005697`*^9, 3.865207247531867*^9}, {
  3.865207280528974*^9, 3.865207303412386*^9}, {3.8652073430753517`*^9, 
  3.8652075956218843`*^9}, {3.865207711429014*^9, 3.865207720995796*^9}, {
  3.86520777606754*^9, 3.865207776696418*^9}, {3.865207924276455*^9, 
  3.86520806811456*^9}, {3.871829018750516*^9, 3.871829025925638*^9}, {
  3.8718290726528997`*^9, 3.87182907663708*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"9480aa93-f188-4e0e-9da4-37969caa789d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["meanVarErrPlot[]", "Subsubsection",
 CellChangeTimes->{{3.866586293327869*^9, 
  3.866586305095727*^9}},ExpressionUUID->"e3962542-ed49-4c34-888f-\
44bf5c09bce9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "meanVarErrPlot", "]"}], "=", 
   RowBox[{"Options", "[", "ListPlot", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"meanVarErrPlot", "[", 
    RowBox[{"data_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Depth", "[", "data", "]"}], "==", "3"}]}], ":=", 
  RowBox[{"Show", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ListLinePlot", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"KeyValueMap", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#1", ",", 
           RowBox[{"Around", "[", 
            RowBox[{
             RowBox[{"Mean", "[", "#2", "]"}], ",", 
             RowBox[{"StandardDeviation", "[", "#2", "]"}]}], "]"}]}], "}"}], 
         "&"}], ",", 
        RowBox[{"Select", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "&"}]}], "]"}]}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"IntervalMarkers", "\[Rule]", "\"\<Bands\>\""}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"KeyValueMap", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#1", ",", 
           RowBox[{"Around", "[", 
            RowBox[{
             RowBox[{"Mean", "[", "#2", "]"}], ",", 
             RowBox[{
              RowBox[{"StandardDeviation", "[", "#2", "]"}], "/", 
              SqrtBox[
               RowBox[{"Length", "[", "#2", "]"}]]}]}], "]"}]}], "}"}], "&"}],
         ",", 
        RowBox[{"Select", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "&"}]}], "]"}]}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"IntervalMarkers", "\[Rule]", "\"\<Fences\>\""}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"List", "[", "opts", "]"}], ",", 
       RowBox[{"Options", "[", "ListPlot", "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.866585475226809*^9, 3.866585484451664*^9}, {
  3.866585543311795*^9, 3.866585560275814*^9}, {3.866585592817173*^9, 
  3.866585707966405*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"07d1ff0e-868c-4067-a3bd-3fa411bab1c3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "meanVarErrPlot", "]"}], "=", 
   RowBox[{"Options", "[", "ListPlot", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"meanVarErrPlot", "[", 
    RowBox[{"data_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Depth", "[", "data", "]"}], "==", "4"}]}], ":=", 
  RowBox[{"Show", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ListLinePlot", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"KeyValueMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#1", ",", 
             RowBox[{"Around", "[", 
              RowBox[{
               RowBox[{"Mean", "[", "#2", "]"}], ",", 
               RowBox[{"StandardDeviation", "[", "#2", "]"}]}], "]"}]}], 
            "}"}], "&"}], ",", 
          RowBox[{"Select", "[", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "&"}]}], "]"}]}],
          "]"}], "&"}], "/@", "data"}], ",", "\[IndentingNewLine]", 
      RowBox[{"IntervalMarkers", "\[Rule]", "\"\<Bands\>\""}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"KeyValueMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#1", ",", 
             RowBox[{"Around", "[", 
              RowBox[{
               RowBox[{"Mean", "[", "#2", "]"}], ",", 
               RowBox[{
                RowBox[{"StandardDeviation", "[", "#2", "]"}], "/", 
                SqrtBox[
                 RowBox[{"Length", "[", "#2", "]"}]]}]}], "]"}]}], "}"}], 
           "&"}], ",", 
          RowBox[{"Select", "[", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "&"}]}], "]"}]}],
          "]"}], "&"}], "/@", "data"}], ",", "\[IndentingNewLine]", 
      RowBox[{"IntervalMarkers", "\[Rule]", "\"\<Fences\>\""}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"List", "[", "opts", "]"}], ",", 
       RowBox[{"Options", "[", "ListPlot", "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.866585723118724*^9, 3.866585742310843*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"5a861345-a7f2-408f-b435-72a84b883ee6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["lineHistogram[]", "Subsubsection",
 CellChangeTimes->{{3.868042286252408*^9, 
  3.8680422906535788`*^9}},ExpressionUUID->"4789f53e-ab25-48b2-acbc-\
72e7d76895f7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "lineHistogram", "]"}], "=", 
   RowBox[{"Options", "[", "ListStepPlot", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lineHistogram", "[", 
   RowBox[{"data_", ",", "bspec_", ",", "hspec_", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"ListStepPlot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Most", "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], "&"}], "@", 
     RowBox[{"HistogramList", "[", 
      RowBox[{"data", ",", "bspec", ",", "hspec"}], "]"}]}], ",", 
    "\[IndentingNewLine]", "opts"}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 CellChangeTimes->{{3.868041671949092*^9, 3.868041826237273*^9}, {
  3.8680418769232283`*^9, 3.86804191137111*^9}, {3.877637016339651*^9, 
  3.877637024682873*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"a7e74071-21d7-4512-8d56-c84f626d6dbd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["withOuterTicks[]", "Subsubsection",
 CellChangeTimes->{{3.935971339043206*^9, 
  3.935971345703329*^9}},ExpressionUUID->"7aaff240-4161-4f02-9d1c-\
491f7640c453"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"generateOuterTicks", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "_"}], "]"}], ":=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generateOuterTicks", "[", 
    RowBox[{"None", ",", "_"}], "]"}], ":=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generateOuterTicks", "[", 
    RowBox[{
     RowBox[{"ticks", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"NumericQ", "[", 
            RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ".."}], 
       "}"}]}], ",", "l_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"#", ",", "#", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "l"}], "}"}]}], "}"}], "&"}], "/@", "ticks"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generateOuterTicks", "[", 
    RowBox[{
     RowBox[{"ticks", ":", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"NumericQ", "[", 
              RowBox[{"N", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ",", "_"}],
          "}"}], ".."}], "}"}]}], ",", "l_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "l"}], "}"}]}], "}"}], "&"}], "/@", "ticks"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8776580748499107`*^9, 3.8776582006972923`*^9}, {
  3.8776582457821217`*^9, 3.877658247384902*^9}, {3.87766010572867*^9, 
  3.8776601081176434`*^9}, {3.877660547122697*^9, 3.87766056896371*^9}, {
  3.877660686670752*^9, 3.877660757616061*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"5c6b95ef-aac0-4650-bf14-7278d054172b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cleanTickSpec", "[", "ticks_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", "Nothing", ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"DisplayForm", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], 
     "\[IndentingNewLine]", "]"}], "&"}], "/@", "ticks"}]}]], "Input",
 CellChangeTimes->{{3.877715987266127*^9, 3.877716007673737*^9}},
 CellLabel->"In[88]:=",ExpressionUUID->"fc2ebd62-795e-4486-aab0-9f7b761793ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{"withOuterTicks", "[", 
   RowBox[{"plot_", ",", "absLen_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "imgSize", ",", "padding", ",", "ticks", ",", "frame", ",", 
      "frameTicks"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"imgSize", ",", "padding", ",", "frame"}], "}"}], "=", 
      RowBox[{"Values", "[", 
       RowBox[{"AbsoluteOptions", "[", 
        RowBox[{"plot", ",", 
         RowBox[{"{", 
          RowBox[{"ImageSize", ",", "ImagePadding", ",", "Frame"}], "}"}]}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"imgSize", "=", 
      RowBox[{"First", "[", "imgSize", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MatchQ", "[", 
        RowBox[{"frame", ",", 
         RowBox[{"None", "|", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"False", "|", "None"}], ",", 
              RowBox[{"False", "|", "None"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"False", "|", "None"}], ",", 
              RowBox[{"False", "|", "None"}]}], "}"}]}], "}"}]}]}], "]"}], 
       ",", 
       RowBox[{"frame", "=", "False"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"frame", "=!=", "False"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Has", " ", "frame"}], " ", "->", " ", 
         RowBox[{"axis", " ", "ticks", " ", 
          RowBox[{"don", "'"}], "t", " ", "get", " ", "rendered"}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"frameTicks", "=", 
         RowBox[{"First", "[", 
          RowBox[{"Values", "[", 
           RowBox[{"AbsoluteOptions", "[", 
            RowBox[{"plot", ",", "FrameTicks"}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"frameTicks", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"cleanTickSpec", ",", "frameTicks", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"frameTicks", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"generateOuterTicks", "[", 
             RowBox[{"#", ",", 
              RowBox[{"absLen", "/", 
               RowBox[{"(", 
                RowBox[{"imgSize", "-", 
                 RowBox[{"Total", "[", 
                  RowBox[{"padding", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ")"}]}]}], "]"}], 
            "&"}], ",", "frameTicks", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"padding", "+=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"absLen", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Show", "[", 
         RowBox[{"plot", ",", "\[IndentingNewLine]", 
          RowBox[{"FrameTicks", "->", "frameTicks"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "imgSize"}], ",", "\[IndentingNewLine]", 
          
          RowBox[{"ImagePadding", "->", "padding"}]}], "\[IndentingNewLine]", 
         "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"No", " ", "frame"}], " ", "->", " ", 
         RowBox[{"render", " ", "axis", " ", "ticks"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ticks", "=", 
         RowBox[{"First", "[", 
          RowBox[{"Values", "[", 
           RowBox[{"AbsoluteOptions", "[", 
            RowBox[{"plot", ",", "Ticks"}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ticks", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"cleanTickSpec", ",", "ticks"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ticks", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"generateOuterTicks", "[", 
             RowBox[{"#", ",", 
              RowBox[{"absLen", "/", 
               RowBox[{"(", 
                RowBox[{"imgSize", "-", 
                 RowBox[{"Total", "[", 
                  RowBox[{"padding", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ")"}]}]}], "]"}], 
            "&"}], ",", "ticks"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"padding", "+=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"absLen", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"absLen", ",", "0"}], "}"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Show", "[", 
         RowBox[{"plot", ",", "\[IndentingNewLine]", 
          RowBox[{"Ticks", "->", "ticks"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "imgSize"}], ",", "\[IndentingNewLine]", 
          
          RowBox[{"ImagePadding", "->", "padding"}]}], "\[IndentingNewLine]", 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.877657623851338*^9, 3.877657828980586*^9}, {
   3.877657894742594*^9, 3.8776580423882513`*^9}, {3.877658207032228*^9, 
   3.877658365694021*^9}, {3.877660110487392*^9, 3.877660113171987*^9}, {
   3.877660159236412*^9, 3.87766016605116*^9}, {3.8776602114072104`*^9, 
   3.8776602155578947`*^9}, {3.8776604760677633`*^9, 3.877660487715797*^9}, {
   3.877660761643298*^9, 3.877660768359623*^9}, 3.877660992022731*^9, {
   3.8776611437294617`*^9, 3.8776611472972507`*^9}, {3.877661181197145*^9, 
   3.877661223345708*^9}, {3.8776612986824207`*^9, 3.8776613006219788`*^9}, {
   3.877713880757526*^9, 3.877713881501027*^9}, {3.877713932372856*^9, 
   3.8777140634489098`*^9}, {3.877714496120648*^9, 3.877714499124646*^9}, {
   3.877714547334106*^9, 3.87771454970551*^9}, {3.8777154888522377`*^9, 
   3.87771551031113*^9}, {3.8777155766112413`*^9, 3.8777156488549347`*^9}, {
   3.877715699651581*^9, 3.8777158517413588`*^9}, {3.877715882667856*^9, 
   3.877715904876906*^9}, {3.877716002793084*^9, 3.87771634356181*^9}, {
   3.877716384562007*^9, 3.877716402211165*^9}, {3.877716452993688*^9, 
   3.877716455142107*^9}, {3.877802678390253*^9, 3.87780281254044*^9}, {
   3.889301107615593*^9, 3.889301108232855*^9}, 3.889301215646092*^9},
 CellLabel->"In[89]:=",ExpressionUUID->"797cecbf-13fd-4d9f-8c23-1dafee75cf0b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Render tensor eigenvectors", "Subsubsection",
 CellChangeTimes->{{3.93602936795415*^9, 
  3.936029376429934*^9}},ExpressionUUID->"68aeb7db-bb8c-44d1-a9da-\
60645cb93440"],

Cell[BoxData[
 RowBox[{
  RowBox[{"magenta", "=", 
   RowBox[{"RGBColor", "[", 
    RowBox[{"0.9", ",", "0.3", ",", "0.8"}], "]"}]}], ";"}]], "Input",
 CellLabel->"In[78]:=",ExpressionUUID->"f7bb243c-2a96-4add-b6e6-3ecf6a93cff6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"renderTensor", "[", 
   RowBox[{"p_", ",", "S_", ",", 
    RowBox[{"scale_", ":", "1"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"es", "=", 
      RowBox[{"Eigensystem", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"S", "+", 
          RowBox[{"Transpose", "[", "S", "]"}]}], ")"}], "/", "2"}], "]"}]}], 
     "}"}], ",", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"es", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "<", "0"}], ",", "magenta", 
        ",", 
        RowBox[{"Darker", "[", "Cyan", "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Line", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"p", "-", "#"}], ",", 
           RowBox[{"p", "+", "#"}]}], "}"}], "&"}], "@", 
        RowBox[{"(", 
         RowBox[{"scale", " ", 
          RowBox[{"es", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], 
          RowBox[{"es", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ")"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"es", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], "<", "0"}], ",", "magenta", 
        ",", 
        RowBox[{"Darker", "[", "Cyan", "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Line", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"p", "-", "#"}], ",", 
           RowBox[{"p", "+", "#"}]}], "}"}], "&"}], "@", 
        RowBox[{"(", 
         RowBox[{"scale", " ", 
          RowBox[{"es", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], 
          RowBox[{"es", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ")"}]}], "]"}]}], 
     "\[IndentingNewLine]", "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.871934003494636*^9, 3.871934031355291*^9}, {
  3.8719340705716763`*^9, 3.871934152502819*^9}, {3.8719344331158657`*^9, 
  3.871934446969136*^9}, {3.877561326754386*^9, 3.877561354094297*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"cad422e2-c25e-48d4-b965-df6b98513769"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{914, 1005},
WindowMargins->{{355, Automatic}, {Automatic, -145}},
FrontEndVersion->"13.0 for Mac OS X x86 (64-bit) (February 4, 2022)",
StyleDefinitions->"MyDefaultStylesheet.nb",
ExpressionUUID->"bb2493d1-c102-4598-b653-c25d4a67ac8d"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 168, 3, 45, "Subsubsection",ExpressionUUID->"2854a677-3287-478d-bfb8-1210155908e0"],
Cell[751, 27, 1073, 24, 32, "Input",ExpressionUUID->"22330982-232e-4dd3-9168-c7712757c539"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1861, 56, 163, 3, 45, "Subsubsection",ExpressionUUID->"ecdba1eb-3309-4e82-b2c7-88ffe0c4d305"],
Cell[2027, 61, 528, 10, 55, "Input",ExpressionUUID->"d8b8f33f-8fa5-47c0-bfbf-f188df775b74"],
Cell[2558, 73, 498, 10, 55, "Input",ExpressionUUID->"aa7597b1-a995-4df1-80cb-dd1ffbcfb60e"],
Cell[3059, 85, 1425, 37, 187, "Input",ExpressionUUID->"645b3a5a-6091-44fb-9fec-3417be95f059"],
Cell[4487, 124, 1595, 39, 187, "Input",ExpressionUUID->"578da685-c707-4169-bf7f-33ce6d646a03"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6119, 168, 170, 3, 45, "Subsubsection",ExpressionUUID->"c8a15600-5f9d-414e-a3da-c7a09089e895"],
Cell[6292, 173, 2476, 67, 363, "Input",ExpressionUUID->"17cd2f00-7692-439d-aa28-9b46dbdae290"]
}, Open  ]],
Cell[CellGroupData[{
Cell[8805, 245, 216, 4, 45, "Subsubsection",ExpressionUUID->"d913c777-c59e-46b1-a425-0e8e52a5b026"],
Cell[9024, 251, 2838, 73, 341, "Input",ExpressionUUID->"fad0a8a1-17af-4fe2-9fbb-e7f81f424df4"],
Cell[11865, 326, 236, 6, 51, "Text",ExpressionUUID->"98582073-510a-433c-8a7e-e1a2308562ae"],
Cell[12104, 334, 2664, 68, 363, "Input",ExpressionUUID->"34c39e81-fee8-4af6-ad14-f01256fac6d8"],
Cell[14771, 404, 2554, 67, 341, "Input",ExpressionUUID->"2be57e66-0a0a-4b87-80ee-d9b4f9531cdc"],
Cell[17328, 473, 1660, 44, 143, "Input",ExpressionUUID->"e81b9df3-9e41-4440-9772-d56fa4ce860f"],
Cell[18991, 519, 4883, 129, 473, "Input",ExpressionUUID->"b1939b6f-50d3-4c4c-bc68-4149a3a18165"],
Cell[23877, 650, 2145, 57, 187, "Input",ExpressionUUID->"37c8c37a-665f-4240-bbe8-9802faf1c3ba"],
Cell[26025, 709, 1696, 37, 275, "Input",ExpressionUUID->"060e0f42-6a8e-4780-be1c-f5413f9eff85"],
Cell[27724, 748, 2359, 53, 319, "Input",ExpressionUUID->"f9d9493b-634e-46e2-b384-4d8347c7884e"],
Cell[30086, 803, 1110, 29, 77, "Input",ExpressionUUID->"5b564ae3-2b1a-48b6-b8be-e672f74fcbfc"],
Cell[31199, 834, 2388, 50, 209, "Input",ExpressionUUID->"2c3e74b8-0784-40e1-8392-ce4047c11a43"]
}, Open  ]],
Cell[CellGroupData[{
Cell[33624, 889, 167, 3, 45, "Subsubsection",ExpressionUUID->"c3e798d1-d63e-4d15-baa0-7db35588ea09"],
Cell[33794, 894, 2152, 60, 231, "Input",ExpressionUUID->"590e420b-e816-460e-ad01-4412bd5d64bd"],
Cell[35949, 956, 1648, 45, 187, "Input",ExpressionUUID->"76b6e31e-c1ca-42d6-83bc-30fb23b9a1c1"],
Cell[37600, 1003, 2269, 62, 209, "Input",ExpressionUUID->"4a735b89-9a96-4020-bc23-ce78894fd46a"],
Cell[39872, 1067, 1571, 45, 187, "Input",ExpressionUUID->"0aacec08-d087-465f-9956-e0baf2333d73"],
Cell[41446, 1114, 1621, 45, 187, "Input",ExpressionUUID->"6fe6d71e-5bf8-4236-8c49-f84254f69182"],
Cell[43070, 1161, 2945, 76, 239, "Input",ExpressionUUID->"037e862c-f9de-4015-81ea-379bc0882d03"],
Cell[46018, 1239, 3803, 103, 336, "Input",ExpressionUUID->"b3ff6a02-ca3d-4691-a8a7-784bfa8ddae1"],
Cell[49824, 1344, 501, 11, 55, "Input",ExpressionUUID->"33b33cbc-9fee-4dc6-99f3-e53974f544e5"],
Cell[50328, 1357, 2826, 76, 206, "Input",ExpressionUUID->"96a8c17b-7a1c-4fcb-be83-b9d4f60d9962"],
Cell[53157, 1435, 3215, 85, 228, "Input",ExpressionUUID->"4c551906-40c4-4559-baad-b1229c94ecaa"],
Cell[56375, 1522, 581, 15, 32, "Input",ExpressionUUID->"3fe24a84-b25a-4717-8ed3-a1bc7e0dd9af"]
}, Open  ]],
Cell[CellGroupData[{
Cell[56993, 1542, 178, 3, 45, "Subsubsection",ExpressionUUID->"5ee124f1-3f3f-4fdd-b776-8c2db014e3af"],
Cell[57174, 1547, 9613, 246, 737, "Input",ExpressionUUID->"6133604d-80b0-4f7f-bdc4-ca32113bc22d"],
Cell[66790, 1795, 1611, 47, 76, "Input",ExpressionUUID->"def3c949-c7aa-479e-aa8b-19b211b98ac1"],
Cell[68404, 1844, 2113, 60, 187, "Input",ExpressionUUID->"8d3a377f-15ef-4ece-b834-88d497d4c203"]
}, Open  ]],
Cell[CellGroupData[{
Cell[70554, 1909, 176, 3, 45, "Subsubsection",ExpressionUUID->"cb017957-cc1c-4e4c-880c-58de66589fe4"],
Cell[70733, 1914, 2845, 71, 322, "Input",ExpressionUUID->"576e8e8f-cc04-4614-905e-254e28778ea9"],
Cell[73581, 1987, 1883, 51, 253, "Input",ExpressionUUID->"9066bcc4-de5a-4b67-b24c-d0190ad5b7f8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[75501, 2043, 181, 3, 45, "Subsubsection",ExpressionUUID->"bb3a9d2d-c939-4486-a3ff-456a85719195"],
Cell[75685, 2048, 5963, 149, 583, "Input",ExpressionUUID->"c432d8aa-77cf-4ab2-95e7-b2c386cf71ec"],
Cell[81651, 2199, 4132, 105, 275, "Input",ExpressionUUID->"c3bc7c8d-6181-4334-893b-c40937d78b88"],
Cell[85786, 2306, 2212, 55, 341, "Input",ExpressionUUID->"b0290340-6943-4931-b0a3-dcc5992ebc3c"],
Cell[88001, 2363, 1204, 26, 32, "Input",ExpressionUUID->"b802b705-7b4e-437a-8530-4b278d49199b"],
Cell[89208, 2391, 5585, 127, 568, "Input",ExpressionUUID->"17349eb6-7e80-4d6d-8be7-9817f8bfb07b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[94830, 2523, 177, 3, 45, "Subsubsection",ExpressionUUID->"9bc7cc82-fa5e-4c16-802e-429dabfc52c3"],
Cell[95010, 2528, 1378, 33, 99, "Input",ExpressionUUID->"14c8d94d-a45c-4a05-b88b-d3e79548ca3c"],
Cell[96391, 2563, 6873, 168, 451, "Input",ExpressionUUID->"09b58b65-4dbe-40ce-91a5-958757e052c5"],
Cell[103267, 2733, 2882, 74, 275, "Input",ExpressionUUID->"068ec2d8-0261-42e4-9974-544fcbecb3f0"],
Cell[106152, 2809, 889, 26, 32, "Input",ExpressionUUID->"5882e444-d784-4dda-96a9-572ef0d7e613"],
Cell[107044, 2837, 1026, 24, 187, "Input",ExpressionUUID->"b930b1dd-e52a-4504-b2ec-c3b979c77979"],
Cell[108073, 2863, 1342, 32, 187, "Input",ExpressionUUID->"3f42844f-50dc-4681-aa6f-35aa32a79fb8"],
Cell[109418, 2897, 1311, 34, 143, "Input",ExpressionUUID->"8613a32e-dffc-4d4a-ac29-57008b929414"],
Cell[110732, 2933, 2169, 54, 187, "Input",ExpressionUUID->"cb4fb892-35ab-4cd0-b0bb-b830662da442"]
}, Open  ]],
Cell[CellGroupData[{
Cell[112938, 2992, 170, 3, 45, "Subsubsection",ExpressionUUID->"c52052b9-cc29-4cc3-a0a0-d4eca7b4afa6"],
Cell[113111, 2997, 1024, 27, 77, "Input",ExpressionUUID->"4b9eebb8-487a-4ba0-a841-1fc3d32914a1"],
Cell[114138, 3026, 315, 7, 74, "Text",ExpressionUUID->"b23c0ec5-8952-4165-8fca-7928848a5cb7"],
Cell[114456, 3035, 1155, 33, 77, "Input",ExpressionUUID->"d5d136c5-4b62-4240-802e-7032a03ca2fe"],
Cell[115614, 3070, 1652, 51, 77, "Input",ExpressionUUID->"a13db603-af99-4b3e-94ad-29d4436fdaf6"],
Cell[117269, 3123, 695, 18, 32, "Input",ExpressionUUID->"de4adcf3-5b8c-4492-812c-edfeae6ad6f9"],
Cell[117967, 3143, 1707, 36, 297, "Input",ExpressionUUID->"0b959ec6-330f-46a3-b1c9-3d9e9dae9b85"]
}, Open  ]],
Cell[CellGroupData[{
Cell[119711, 3184, 159, 3, 45, "Subsubsection",ExpressionUUID->"64d991fa-a4a7-44a9-92ee-44f8fabff933"],
Cell[119873, 3189, 922, 26, 55, "Input",ExpressionUUID->"1ce72407-6fe0-4937-a313-7e9e542a8cb6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[120832, 3220, 160, 3, 45, "Subsubsection",ExpressionUUID->"c134c998-d95f-4ff6-ba1e-789f7d13ab88"],
Cell[120995, 3225, 521, 13, 32, "Input",ExpressionUUID->"ef20adaf-e4a1-4e56-b850-4f67694d483c"],
Cell[121519, 3240, 1124, 31, 55, "Input",ExpressionUUID->"474e52a1-bd43-4783-a381-0388994532a0"],
Cell[122646, 3273, 1469, 36, 165, "Input",ExpressionUUID->"3152f893-9fb2-47d3-8cf5-ec38955e268c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[124152, 3314, 167, 3, 45, "Subsubsection",ExpressionUUID->"bb91eff0-d76c-4096-8798-d88d9c636b63"],
Cell[124322, 3319, 1211, 27, 55, "Input",ExpressionUUID->"c384a172-5ccd-40d2-bd68-4ace20663f3f"],
Cell[125536, 3348, 1627, 43, 121, "Input",ExpressionUUID->"210a5e3c-f604-4fe6-9a03-c7029b786c24"],
Cell[127166, 3393, 1448, 37, 187, "Input",ExpressionUUID->"482a3b8d-04b5-48b7-b88f-3d60e2fcb582"],
Cell[128617, 3432, 1447, 38, 231, "Input",ExpressionUUID->"81fdbda0-2e40-4bda-9962-6259edfd823c"],
Cell[130067, 3472, 741, 20, 55, "Input",ExpressionUUID->"003f4c00-d23c-4903-86a2-13ef9ef31034"]
}, Open  ]],
Cell[CellGroupData[{
Cell[130845, 3497, 189, 3, 45, "Subsubsection",ExpressionUUID->"bb413fe8-53f7-4072-8e5f-1eef23815cbd"],
Cell[131037, 3502, 1214, 28, 187, "Input",ExpressionUUID->"40febb44-a707-450f-8891-d8634e5a6517"],
Cell[132254, 3532, 979, 27, 55, "Input",ExpressionUUID->"fdfdf855-29e9-450b-a023-15b19b6a426a"],
Cell[133236, 3561, 762, 16, 55, "Input",ExpressionUUID->"d2b9d991-2338-4125-a364-b592e6f3a644"]
}, Open  ]],
Cell[CellGroupData[{
Cell[134035, 3582, 192, 3, 45, "Subsubsection",ExpressionUUID->"c9912e61-fbfb-423c-8d40-adf9cd28677b"],
Cell[134230, 3587, 220, 3, 32, "Input",ExpressionUUID->"37423008-7995-45b3-94db-25bf5fe1af1e"],
Cell[134453, 3592, 3991, 92, 583, "Input",ExpressionUUID->"92bc054d-293f-46bc-9d11-a0223a8bccae"]
}, Open  ]],
Cell[CellGroupData[{
Cell[138481, 3689, 155, 3, 54, "Subsection",ExpressionUUID->"11e7d881-058a-4b1a-928d-aabaf01fba8c"],
Cell[CellGroupData[{
Cell[138661, 3696, 167, 3, 45, "Subsubsection",ExpressionUUID->"2460b586-31cc-437f-8da1-a1140e8469e9"],
Cell[138831, 3701, 775, 17, 55, "Input",ExpressionUUID->"ab354758-72fe-44b8-add9-29a8c4e02ced"],
Cell[139609, 3720, 1879, 41, 187, "Input",ExpressionUUID->"50db5fb0-722b-442f-8ad0-f7c513e8860e"],
Cell[141491, 3763, 293, 7, 32, "Input",ExpressionUUID->"3858d655-9cd6-4074-83ac-806f55eb8d42"],
Cell[141787, 3772, 579, 14, 55, "Input",ExpressionUUID->"4cbab325-af12-4960-9511-b5f7d03a50c0"],
Cell[142369, 3788, 349, 7, 32, "Input",ExpressionUUID->"344d4ae1-4137-4a11-9f7d-f698be000380"],
Cell[142721, 3797, 431, 8, 55, "Input",ExpressionUUID->"c1072c3a-0aab-4ae9-bd8e-fc1bc116946c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[143189, 3810, 169, 3, 45, "Subsubsection",ExpressionUUID->"d027212c-91e9-465f-a888-a355144b9312"],
Cell[143361, 3815, 2563, 79, 255, "Input",ExpressionUUID->"56dc4437-04fe-4802-b030-208683be7dea"]
}, Open  ]],
Cell[CellGroupData[{
Cell[145961, 3899, 178, 3, 45, "Subsubsection",ExpressionUUID->"01319d67-4616-4d9c-96a2-f7c58bf72c14"],
Cell[146142, 3904, 1609, 43, 121, "Input",ExpressionUUID->"14c22970-b02f-4014-805d-d278f6db895f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[147788, 3952, 164, 3, 45, "Subsubsection",ExpressionUUID->"62479e14-52ba-4d92-87ca-93d198369095"],
Cell[147955, 3957, 632, 18, 32, "Input",ExpressionUUID->"92c3fdfe-8e37-4dd7-8d55-bd6cd75e70a4"],
Cell[148590, 3977, 907, 21, 32, "Input",ExpressionUUID->"b793a153-95ab-407e-8a99-851083aa5fb0"],
Cell[149500, 4000, 700, 19, 32, "Input",ExpressionUUID->"fa347930-e12a-4189-975a-323fdc1cf237"],
Cell[150203, 4021, 286, 7, 32, "Input",ExpressionUUID->"a99e9352-1172-438f-b264-8aa4bef3afb5"],
Cell[150492, 4030, 396, 10, 32, "Input",ExpressionUUID->"6d9e1683-6ee4-4340-bf03-1f447d58539e"],
Cell[150891, 4042, 3687, 92, 297, "Input",ExpressionUUID->"a0df2018-9700-4958-a0ac-c79a8d10609c"],
Cell[154581, 4136, 672, 17, 32, "Input",ExpressionUUID->"a1cde499-9f2f-4d95-b34a-8907aa1ed37f"],
Cell[155256, 4155, 1212, 32, 145, "Input",ExpressionUUID->"abeba6e9-e762-4370-aed3-e86457415a8c"],
Cell[156471, 4189, 815, 23, 56, "Input",ExpressionUUID->"527fa79e-56c6-45d7-b13f-87c4cf0d0f31"],
Cell[157289, 4214, 660, 17, 33, "Input",ExpressionUUID->"fc132d75-b83a-4e86-a356-bc20ce0ef23a"],
Cell[157952, 4233, 671, 17, 77, "Input",ExpressionUUID->"8ed2af03-b9e1-4457-8829-cb36d0843e4e"],
Cell[158626, 4252, 919, 27, 77, "Input",ExpressionUUID->"ff368217-3423-4d8b-8f6d-c44018ad1f63"],
Cell[159548, 4281, 1019, 31, 55, "Input",ExpressionUUID->"74cd8e50-cb4e-4bae-a40b-f17123143b6d"],
Cell[160570, 4314, 869, 25, 55, "Input",ExpressionUUID->"27c83e8a-ec78-4de4-a554-c7e4853dd355"],
Cell[161442, 4341, 703, 21, 32, "Input",ExpressionUUID->"5c3cb40b-7801-467d-a43c-246a76051173"],
Cell[162148, 4364, 433, 12, 32, "Input",ExpressionUUID->"0249d40f-1d5d-4d22-ac64-cfb1ec6b0885"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[162630, 4382, 158, 3, 54, "Subsection",ExpressionUUID->"c39456d1-bd33-4db2-b4aa-2b09ecd4a119"],
Cell[CellGroupData[{
Cell[162813, 4389, 158, 3, 45, "Subsubsection",ExpressionUUID->"d3d3c586-de86-4463-8bc9-7c3448e2db1f"],
Cell[162974, 4394, 944, 24, 143, "Input",ExpressionUUID->"2c7ee695-44e6-400f-9466-b4782e9f9243"]
}, Open  ]],
Cell[CellGroupData[{
Cell[163955, 4423, 175, 3, 45, "Subsubsection",ExpressionUUID->"4644a33e-77f5-4760-b284-e1d5dd724d24"],
Cell[164133, 4428, 300, 7, 32, "Input",ExpressionUUID->"3715e484-bc44-4aaf-8719-c223e0a79ab0"],
Cell[164436, 4437, 3965, 92, 495, "Input",ExpressionUUID->"9480aa93-f188-4e0e-9da4-37969caa789d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[168438, 4534, 167, 3, 45, "Subsubsection",ExpressionUUID->"e3962542-ed49-4c34-888f-44bf5c09bce9"],
Cell[168608, 4539, 2579, 69, 314, "Input",ExpressionUUID->"07d1ff0e-868c-4067-a3bd-3fa411bab1c3"],
Cell[171190, 4610, 2655, 71, 336, "Input",ExpressionUUID->"5a861345-a7f2-408f-b435-72a84b883ee6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[173882, 4686, 168, 3, 45, "Subsubsection",ExpressionUUID->"4789f53e-ab25-48b2-acbc-72e7d76895f7"],
Cell[174053, 4691, 1154, 31, 121, "Input",ExpressionUUID->"a7e74071-21d7-4512-8d56-c84f626d6dbd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[175244, 4727, 167, 3, 45, "Subsubsection",ExpressionUUID->"7aaff240-4161-4f02-9d1c-491f7640c453"],
Cell[175414, 4732, 2020, 62, 99, "Input",ExpressionUUID->"5c6b95ef-aac0-4650-bf14-7278d054172b"],
Cell[177437, 4796, 769, 20, 99, "Input",ExpressionUUID->"fc2ebd62-795e-4486-aab0-9f7b761793ea"],
Cell[178209, 4818, 6664, 150, 695, "Input",ExpressionUUID->"797cecbf-13fd-4d9f-8c23-1dafee75cf0b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[184910, 4973, 176, 3, 45, "Subsubsection",ExpressionUUID->"68aeb7db-bb8c-44d1-a9da-60645cb93440"],
Cell[185089, 4978, 229, 5, 32, "Input",ExpressionUUID->"f7bb243c-2a96-4add-b6e6-3ecf6a93cff6"],
Cell[185321, 4985, 2427, 70, 143, "Input",ExpressionUUID->"cad422e2-c25e-48d4-b965-df6b98513769"]
}, Open  ]]
}, Open  ]]
}
]
*)

